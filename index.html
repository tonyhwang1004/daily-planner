<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¹€ì—„ë§ˆë…ì„œì‹¤ | ì¼ì¼í”Œë˜ë„ˆ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a5f;
            --primary-light: #2d5a8b;
            --primary-dark: #0f1f33;
            --accent: #3b82f6;
            --accent-light: #60a5fa;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            min-height: 100vh;
            color: var(--gray-800);
        }
        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary);
        }
        .logo i { font-size: 1.4rem; color: var(--accent); }
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--gray-600);
        }
        .user-avatar {
            width: 32px; height: 32px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
        }
        .logout-btn {
            background: none;
            border: none;
            color: var(--gray-400);
            cursor: pointer;
            padding: 0.25rem;
            font-size: 1rem;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 70px 1rem 100px;
            min-height: 100vh;
        }
        .screen { display: none; animation: fadeIn 0.3s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .login-wrapper {
            min-height: calc(100vh - 100px);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-box {
            background: white;
            border-radius: 20px;
            padding: 2.5rem 2rem;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .login-header .icon {
            width: 70px; height: 70px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
            color: white;
        }
        .login-header h1 { font-size: 1.5rem; color: var(--primary); margin-bottom: 0.5rem; }
        .login-header p { color: var(--gray-500); font-size: 0.9rem; }
        .form-group { margin-bottom: 1.25rem; }
        .form-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }
        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.2s;
            background: var(--gray-50);
        }
        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
        }
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
        }
        .btn-sm { padding: 0.5rem 1rem; font-size: 0.85rem; width: auto; }
        .btn-xs { padding: 0.35rem 0.75rem; font-size: 0.75rem; width: auto; }
        .card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .card-title i { color: var(--accent); }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        .stat-card {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--primary); }
        .stat-value.success { color: var(--success); }
        .stat-value.warning { color: var(--warning); }
        .stat-label { font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem; }
        .progress-container { margin: 1rem 0; }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.85rem; }
        .progress-bar { height: 10px; background: var(--gray-200); border-radius: 10px; overflow: hidden; }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent) 0%, var(--success) 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        .menu-item {
            background: white;
            border-radius: 16px;
            padding: 1.5rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 2px solid transparent;
        }
        .menu-item:hover {
            transform: translateY(-3px);
            border-color: var(--accent);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.15);
        }
        .menu-item .icon {
            width: 50px; height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.75rem;
            font-size: 1.5rem;
        }
        .menu-item .icon.blue { background: rgba(59, 130, 246, 0.1); color: var(--accent); }
        .menu-item .icon.green { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .menu-item .icon.orange { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .menu-item .icon.purple { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }
        .menu-item .icon.red { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .menu-item h3 { font-size: 0.95rem; color: var(--gray-800); margin-bottom: 0.25rem; }
        .menu-item p { font-size: 0.75rem; color: var(--gray-500); }
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: white;
            padding: 0.5rem 1rem;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 100;
        }
        .bottom-nav-content {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-around;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 1rem;
            color: var(--gray-400);
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 12px;
        }
        .nav-item.active { color: var(--accent); }
        .nav-item i { font-size: 1.25rem; margin-bottom: 0.25rem; }
        .nav-item span { font-size: 0.7rem; font-weight: 500; }

        /* êµì¬ ì•„ì´í…œ */
        .book-item {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .book-info h4 { font-size: 0.95rem; color: var(--gray-800); }
        .book-info p { font-size: 0.8rem; color: var(--gray-500); }
        .book-actions {
            display: flex;
            gap: 0.5rem;
        }
        .subject-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-korean { background: #fef3c7; color: #d97706; }
        .badge-math { background: #dbeafe; color: #2563eb; }
        .badge-english { background: #dcfce7; color: #16a34a; }
        .badge-science { background: #f3e8ff; color: #9333ea; }
        .badge-social { background: #fce7f3; color: #db2777; }
        .delete-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--gray-200);
            color: var(--gray-500);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .delete-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* ì£¼ê°„ ê³„íší‘œ (í‘œ í˜•ì‹) */
        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: white;
            border-radius: 12px;
            margin-bottom: 1rem;
        }
        .week-nav-btn {
            width: 36px; height: 36px;
            border: none;
            background: var(--gray-100);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            transition: all 0.2s;
        }
        .week-nav-btn:hover { background: var(--accent); color: white; }
        .week-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* ì´ë²ˆì£¼ ëª©í‘œ */
        .goal-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .goal-title {
            font-weight: 700;
            color: #92400e;
            font-size: 0.9rem;
        }
        .goal-edit-btn {
            background: none;
            border: none;
            color: #92400e;
            cursor: pointer;
            font-size: 0.85rem;
        }
        .goal-content {
            font-size: 0.85rem;
            color: #78350f;
            line-height: 1.5;
        }
        .goal-content p {
            margin-bottom: 0.25rem;
        }

        /* ì£¼ê°„ ê³„íš í…Œì´ë¸” */
        .weekly-table-container {
            overflow-x: auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        .weekly-table {
            width: 100%;
            min-width: 700px;
            border-collapse: collapse;
            font-size: 0.8rem;
        }
        .weekly-table th {
            background: var(--primary);
            color: white;
            padding: 10px 8px;
            font-weight: 600;
            text-align: center;
            position: sticky;
            top: 0;
        }
        .weekly-table th:first-child,
        .weekly-table th:nth-child(2) {
            position: sticky;
            left: 0;
            z-index: 2;
        }
        .weekly-table th:first-child { left: 0; min-width: 60px; }
        .weekly-table th:nth-child(2) { left: 60px; min-width: 80px; }
        .weekly-table td {
            padding: 8px;
            border: 1px solid var(--gray-200);
            text-align: center;
            vertical-align: top;
            min-width: 75px;
            height: 60px;
        }
        .weekly-table td:first-child,
        .weekly-table td:nth-child(2) {
            position: sticky;
            background: var(--gray-50);
            font-weight: 600;
        }
        .weekly-table td:first-child { left: 0; }
        .weekly-table td:nth-child(2) { left: 60px; }
        .weekly-table tr:hover td {
            background: rgba(59, 130, 246, 0.05);
        }
        .weekly-table tr:hover td:first-child,
        .weekly-table tr:hover td:nth-child(2) {
            background: var(--gray-100);
        }
        .day-header {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .day-name { font-size: 0.75rem; }
        .day-date { font-size: 0.85rem; font-weight: 700; }
        .day-header.today {
            color: var(--accent);
        }
        .day-header.sat { color: #3b82f6; }
        .day-header.sun { color: #ef4444; }

        /* ì…€ ë‚´ìš© */
        .cell-content {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-height: 40px;
        }
        .cell-plan {
            background: var(--gray-100);
            border-radius: 4px;
            padding: 4px 6px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .cell-plan:hover {
            background: var(--gray-200);
        }
        .cell-plan.completed {
            background: rgba(16, 185, 129, 0.2);
            border-left: 3px solid var(--success);
        }
        .cell-plan.failed {
            background: rgba(239, 68, 68, 0.2);
            border-left: 3px solid var(--danger);
        }
        .cell-plan.pending {
            background: rgba(245, 158, 11, 0.2);
            border-left: 3px solid var(--warning);
        }
        .cell-plan .pages {
            font-size: 0.65rem;
            color: var(--gray-500);
        }
        .cell-plan .status-icon {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.6rem;
        }
        .cell-add {
            width: 100%;
            height: 100%;
            min-height: 40px;
            border: 2px dashed var(--gray-300);
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            color: var(--gray-400);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cell-add:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: rgba(59, 130, 246, 0.05);
        }

        /* ì‹¤ì²œ ê¸°ë¡ */
        .date-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 12px;
            margin-bottom: 1rem;
        }
        .date-nav button {
            width: 36px; height: 36px;
            border: none;
            background: var(--gray-100);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            transition: all 0.2s;
        }
        .date-nav button:hover { background: var(--accent); color: white; }
        .date-display {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            min-width: 150px;
            text-align: center;
        }
        .plan-item {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
        }
        .plan-item.approved { border-color: var(--success); background: rgba(16, 185, 129, 0.05); }
        .plan-item.failed { border-color: var(--danger); background: rgba(239, 68, 68, 0.05); }
        .plan-item.requested { border-color: var(--warning); background: rgba(245, 158, 11, 0.05); }
        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }
        .plan-title { font-weight: 600; color: var(--gray-800); }
        .plan-subtitle { font-size: 0.8rem; color: var(--gray-500); }
        .plan-actions { display: flex; gap: 0.5rem; }
        .plan-btn {
            flex: 1;
            padding: 0.625rem;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .plan-btn.timer {
            background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%);
            color: white;
        }
        .plan-btn.complete { background: var(--success); color: white; }
        .plan-btn.fail { background: var(--gray-200); color: var(--gray-600); }

        /* ë­í‚¹ */
        .ranking-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            background: var(--gray-50);
        }
        .ranking-item.top-1 { background: linear-gradient(135deg, #fef3c7, #fde68a); }
        .ranking-item.top-2 { background: linear-gradient(135deg, #e5e7eb, #d1d5db); }
        .ranking-item.top-3 { background: linear-gradient(135deg, #fed7aa, #fdba74); }
        .ranking-num {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            margin-right: 0.75rem;
        }
        .top-1 .ranking-num { background: #fbbf24; color: white; }
        .top-2 .ranking-num { background: #9ca3af; color: white; }
        .top-3 .ranking-num { background: #f97316; color: white; }
        .ranking-info { flex: 1; }
        .ranking-name { font-weight: 600; font-size: 0.9rem; }
        .ranking-detail { font-size: 0.75rem; color: var(--gray-500); }
        .ranking-score { font-weight: 700; color: var(--accent); }

        /* ìº˜ë¦°ë” */
        .calendar-container {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .calendar-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }
        .calendar-nav {
            display: flex;
            gap: 0.5rem;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .calendar-day-header {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-500);
            padding: 8px 0;
        }
        .calendar-day-header:first-child { color: var(--danger); }
        .calendar-day-header:last-child { color: var(--accent); }
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .calendar-day:hover {
            background: var(--gray-100);
        }
        .calendar-day.today {
            background: var(--accent);
            color: white;
            font-weight: 700;
        }
        .calendar-day.other-month {
            color: var(--gray-300);
        }
        .calendar-day .rate-dot {
            position: absolute;
            bottom: 4px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        .rate-dot.high { background: var(--success); }
        .rate-dot.mid { background: var(--warning); }
        .rate-dot.low { background: var(--danger); }
        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        /* ëª¨ë‹¬ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 1.5rem;
            animation: modalIn 0.3s ease;
        }
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .modal-title { font-size: 1.1rem; font-weight: 700; color: var(--primary); }
        .modal-close {
            width: 32px; height: 32px;
            border: none;
            background: var(--gray-100);
            border-radius: 50%;
            cursor: pointer;
            color: var(--gray-500);
        }
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--gray-800);
            color: white;
            padding: 0.875rem 1.5rem;
            border-radius: 12px;
            font-size: 0.9rem;
            opacity: 0;
            transition: all 0.3s;
            z-index: 300;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--gray-400);
        }
        .empty-state i { font-size: 2.5rem; margin-bottom: 0.75rem; }
        .empty-state p { font-size: 0.9rem; }

        /* ìŠ¤í†±ì›Œì¹˜ */
        .stopwatch-container {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            z-index: 500;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }
        .stopwatch-container.active { display: flex; }
        .stopwatch-subject {
            font-size: 1rem;
            opacity: 0.7;
            margin-bottom: 0.25rem;
        }
        .stopwatch-book {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
        }
        .stopwatch-display {
            font-size: 5rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            letter-spacing: 4px;
        }
        .stopwatch-seconds {
            font-size: 2rem;
            opacity: 0.7;
            font-family: 'Courier New', monospace;
            margin-bottom: 1rem;
        }
        .stopwatch-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 3rem;
        }
        .status-dot {
            width: 12px; height: 12px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 1.5s infinite;
        }
        .status-dot.paused {
            background: var(--warning);
            animation: none;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .stopwatch-buttons {
            display: flex;
            gap: 1.5rem;
        }
        .sw-btn {
            width: 70px; height: 70px;
            border-radius: 50%;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .sw-btn:active { transform: scale(0.95); }
        .sw-btn-pause { background: var(--warning); color: white; }
        .sw-btn-play { background: var(--success); color: white; }
        .sw-btn-stop { background: var(--danger); color: white; }
        .sw-btn-cancel { background: var(--gray-500); color: white; }
        .stopwatch-info {
            position: absolute;
            bottom: 50px;
            color: rgba(255,255,255,0.5);
            font-size: 0.85rem;
        }

        /* ìƒë²Œì  í‘œì‹œ */
        .point-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .point-badge.plus {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        .point-badge.minus {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }
    </style>
</head>
<body>
    <header class="header" id="mainHeader" style="display: none;">
        <div class="header-content">
            <div class="logo"><i class="fas fa-book-open"></i><span>ê¹€ì—„ë§ˆë…ì„œì‹¤</span></div>
            <div class="user-info">
                <span id="headerUserName">ê¹€ì—°ì„œ</span>
                <div class="user-avatar" id="headerAvatar">ê¹€</div>
                <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- ë¡œê·¸ì¸ í™”ë©´ -->
        <div class="screen active" id="loginScreen">
            <div class="login-wrapper">
                <div class="login-box">
                    <div class="login-header">
                        <div class="icon"><i class="fas fa-calendar-check"></i></div>
                        <h1>ì¼ì¼í”Œë˜ë„ˆ</h1>
                        <p>ê¹€ì—„ë§ˆë…ì„œì‹¤ í•™ìŠµ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
                    </div>
                    <div class="form-group">
                        <label>ì¸µ ì„ íƒ</label>
                        <select id="loginFloor" onchange="loadStudentsByFloor()">
                            <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                            <option value="7ì¸µ">7ì¸µ</option>
                            <option value="8ì¸µ">8ì¸µ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ì´ë¦„</label>
                        <select id="loginName"><option value="">ì¸µì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”</option></select>
                    </div>
                    <button class="btn btn-primary" onclick="login()"><i class="fas fa-sign-in-alt"></i> ì‹œì‘í•˜ê¸°</button>
                </div>
            </div>
        </div>

        <!-- í™ˆ í™”ë©´ -->
        <div class="screen" id="homeScreen">
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-chart-pie"></i> ì˜¤ëŠ˜ì˜ í•™ìŠµ í˜„í™©</div>
                    <span id="todayDate" style="font-size: 0.85rem; color: var(--gray-500);"></span>
                </div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="statPlan">0</div><div class="stat-label">ì˜¤ëŠ˜ ê³„íš</div></div>
                    <div class="stat-card"><div class="stat-value success" id="statComplete">0</div><div class="stat-label">ì™„ë£Œ</div></div>
                    <div class="stat-card"><div class="stat-value" id="statTime">0h</div><div class="stat-label">ê³µë¶€ì‹œê°„</div></div>
                    <div class="stat-card"><div class="stat-value warning" id="statPoint">0</div><div class="stat-label">ìƒì </div></div>
                </div>
                <div class="progress-container">
                    <div class="progress-header"><span>ì‹¤ì²œìœ¨</span><span id="progressPercent">0%</span></div>
                    <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
                </div>
            </div>
            <div class="menu-grid">
                <div class="menu-item" onclick="showScreen('bookScreen')"><div class="icon blue"><i class="fas fa-book"></i></div><h3>êµì¬ ê´€ë¦¬</h3><p>ê³¼ëª©ë³„ êµì¬ ë“±ë¡</p></div>
                <div class="menu-item" onclick="showScreen('planScreen')"><div class="icon green"><i class="fas fa-calendar-plus"></i></div><h3>ì£¼ê°„ ê³„íš</h3><p>STEP 1 ê³„íš ìˆ˜ë¦½</p></div>
                <div class="menu-item" onclick="showScreen('recordScreen')"><div class="icon orange"><i class="fas fa-check-double"></i></div><h3>ì‹¤ì²œ ê¸°ë¡</h3><p>STEP 2 ì‹¤ì²œ ì²´í¬</p></div>
                <div class="menu-item" onclick="showScreen('statsScreen')"><div class="icon purple"><i class="fas fa-trophy"></i></div><h3>í†µê³„/ë­í‚¹</h3><p>ê³µë¶€ì‹œê°„ ë­í‚¹</p></div>
                <div class="menu-item" onclick="showScreen('calendarScreen')"><div class="icon red"><i class="fas fa-calendar-alt"></i></div><h3>í•™ìŠµ ìº˜ë¦°ë”</h3><p>ì›”ê°„ í•™ìŠµ í˜„í™©</p></div>
                <div class="menu-item" onclick="showScreen('goalScreen')"><div class="icon orange"><i class="fas fa-bullseye"></i></div><h3>ëª©í‘œ ì„¤ì •</h3><p>ì£¼ê°„/ì›”ê°„ ëª©í‘œ</p></div>
            </div>
        </div>

        <!-- êµì¬ ê´€ë¦¬ í™”ë©´ -->
        <div class="screen" id="bookScreen">
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-book"></i> ë‚´ êµì¬ ëª©ë¡</div>
                    <button class="btn btn-primary btn-sm" onclick="openModal('addBookModal')"><i class="fas fa-plus"></i> ì¶”ê°€</button>
                </div>
                <div id="bookList"></div>
            </div>
        </div>

        <!-- ì£¼ê°„ ê³„íš í™”ë©´ (í…Œì´ë¸” í˜•ì‹) -->
        <div class="screen" id="planScreen">
            <div class="week-header">
                <button class="week-nav-btn" onclick="changeWeek(-1)"><i class="fas fa-chevron-left"></i></button>
                <div>
                    <div class="week-title" id="weekTitle">1ì›” 2ì£¼ì°¨</div>
                    <div style="font-size: 0.8rem; color: var(--gray-500); text-align: center;" id="weekRange">1/6(ì›”) ~ 1/12(ì¼)</div>
                </div>
                <button class="week-nav-btn" onclick="changeWeek(1)"><i class="fas fa-chevron-right"></i></button>
            </div>

            <!-- ì´ë²ˆì£¼ ëª©í‘œ -->
            <div class="goal-box" id="weekGoalBox">
                <div class="goal-header">
                    <span class="goal-title">ğŸ¯ ì´ë²ˆì£¼ ëª©í‘œ</span>
                    <button class="goal-edit-btn" onclick="openModal('editGoalModal')"><i class="fas fa-edit"></i> ìˆ˜ì •</button>
                </div>
                <div class="goal-content" id="weekGoalContent">
                    <p>ëª©í‘œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!</p>
                </div>
            </div>

            <!-- ì£¼ê°„ ê³„íší‘œ -->
            <div class="weekly-table-container">
                <table class="weekly-table" id="weeklyTable">
                    <thead>
                        <tr>
                            <th>ê³¼ëª©</th>
                            <th>êµì¬ëª…</th>
                            <th id="dayHeader0">ì›”</th>
                            <th id="dayHeader1">í™”</th>
                            <th id="dayHeader2">ìˆ˜</th>
                            <th id="dayHeader3">ëª©</th>
                            <th id="dayHeader4">ê¸ˆ</th>
                            <th id="dayHeader5">í† </th>
                            <th id="dayHeader6">ì¼</th>
                        </tr>
                    </thead>
                    <tbody id="weeklyTableBody">
                    </tbody>
                </table>
            </div>
            <div style="margin-top: 1rem; text-align: center;">
                <button class="btn btn-primary btn-sm" onclick="openModal('addPlanModal')" style="width: auto; padding: 0.75rem 1.5rem;">
                    <i class="fas fa-plus"></i> ê³„íš ì¶”ê°€
                </button>
            </div>
        </div>

        <!-- ì‹¤ì²œ ê¸°ë¡ í™”ë©´ -->
        <div class="screen" id="recordScreen">
            <div class="date-nav">
                <button onclick="changeRecordDate(-1)"><i class="fas fa-chevron-left"></i></button>
                <span class="date-display" id="recordDateDisplay">1ì›” 13ì¼</span>
                <button onclick="changeRecordDate(1)"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="card">
                <div class="card-header"><div class="card-title"><i class="fas fa-check-double"></i> ì˜¤ëŠ˜ì˜ ì‹¤ì²œ</div></div>
                <div id="recordList"></div>
            </div>
        </div>

        <!-- í†µê³„/ë­í‚¹ í™”ë©´ -->
        <div class="screen" id="statsScreen">
            <div class="card">
                <div class="card-header"><div class="card-title"><i class="fas fa-chart-bar"></i> ë‚´ í•™ìŠµ í†µê³„</div></div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="myTotalPlan">0</div><div class="stat-label">ì´ ê³„íš</div></div>
                    <div class="stat-card"><div class="stat-value success" id="myTotalComplete">0</div><div class="stat-label">ì´ ì™„ë£Œ</div></div>
                    <div class="stat-card"><div class="stat-value" id="myTotalTime">0h</div><div class="stat-label">ì´ ê³µë¶€ì‹œê°„</div></div>
                    <div class="stat-card"><div class="stat-value warning" id="myTotalPoint">0</div><div class="stat-label">ì´ ìƒì </div></div>
                </div>
                <div class="progress-container">
                    <div class="progress-header"><span>ì „ì²´ ì‹¤ì²œìœ¨</span><span id="myProgressPercent">0%</span></div>
                    <div class="progress-bar"><div class="progress-fill" id="myProgressFill" style="width: 0%"></div></div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><div class="card-title"><i class="fas fa-trophy"></i> ê³µë¶€ì‹œê°„ ë­í‚¹</div></div>
                <div id="rankingList"></div>
            </div>
        </div>

        <!-- í•™ìŠµ ìº˜ë¦°ë” í™”ë©´ -->
        <div class="screen" id="calendarScreen">
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="week-nav-btn" onclick="changeCalendarMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                    <span class="calendar-title" id="calendarTitle">2026ë…„ 1ì›”</span>
                    <button class="week-nav-btn" onclick="changeCalendarMonth(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <div class="calendar-day-header">ì¼</div>
                    <div class="calendar-day-header">ì›”</div>
                    <div class="calendar-day-header">í™”</div>
                    <div class="calendar-day-header">ìˆ˜</div>
                    <div class="calendar-day-header">ëª©</div>
                    <div class="calendar-day-header">ê¸ˆ</div>
                    <div class="calendar-day-header">í† </div>
                </div>
                <div class="calendar-legend">
                    <div class="legend-item"><div class="legend-dot" style="background: var(--success);"></div> 80% ì´ìƒ</div>
                    <div class="legend-item"><div class="legend-dot" style="background: var(--warning);"></div> 50~79%</div>
                    <div class="legend-item"><div class="legend-dot" style="background: var(--danger);"></div> 50% ë¯¸ë§Œ</div>
                </div>
            </div>
            <div class="card" style="margin-top: 1rem;">
                <div class="card-header"><div class="card-title"><i class="fas fa-info-circle"></i> ì´ë‹¬ì˜ ìš”ì•½</div></div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="monthPlans">0</div><div class="stat-label">ì´ë‹¬ ê³„íš</div></div>
                    <div class="stat-card"><div class="stat-value success" id="monthComplete">0</div><div class="stat-label">ì´ë‹¬ ì™„ë£Œ</div></div>
                </div>
            </div>
        </div>

        <!-- ëª©í‘œ ì„¤ì • í™”ë©´ -->
        <div class="screen" id="goalScreen">
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-bullseye"></i> ì´ë²ˆ ì£¼ ëª©í‘œ</div>
                    <button class="btn btn-primary btn-sm" onclick="openModal('editGoalModal')"><i class="fas fa-edit"></i> ìˆ˜ì •</button>
                </div>
                <div id="currentWeekGoal" style="padding: 1rem; background: var(--gray-50); border-radius: 10px;">
                    ëª©í‘œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-calendar-check"></i> ì´ë²ˆ ë‹¬ ëª©í‘œ</div>
                    <button class="btn btn-primary btn-sm" onclick="openModal('editMonthGoalModal')"><i class="fas fa-edit"></i> ìˆ˜ì •</button>
                </div>
                <div id="currentMonthGoal" style="padding: 1rem; background: var(--gray-50); border-radius: 10px;">
                    ëª©í‘œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!
                </div>
            </div>
            <div class="card">
                <div class="card-header"><div class="card-title"><i class="fas fa-star"></i> ìƒë²Œì  í˜„í™©</div></div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value success" id="totalReward">0</div>
                        <div class="stat-label">ì´ ìƒì </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: var(--danger);" id="totalPenalty">0</div>
                        <div class="stat-label">ì´ ë²Œì </div>
                    </div>
                </div>
                <div id="pointHistory" style="max-height: 200px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="bottom-nav" id="bottomNav" style="display: none;">
        <div class="bottom-nav-content">
            <div class="nav-item active" onclick="showScreen('homeScreen')"><i class="fas fa-home"></i><span>í™ˆ</span></div>
            <div class="nav-item" onclick="showScreen('planScreen')"><i class="fas fa-calendar-alt"></i><span>ê³„íš</span></div>
            <div class="nav-item" onclick="showScreen('recordScreen')"><i class="fas fa-check-circle"></i><span>ì‹¤ì²œ</span></div>
            <div class="nav-item" onclick="showScreen('statsScreen')"><i class="fas fa-chart-line"></i><span>í†µê³„</span></div>
        </div>
    </nav>

    <!-- êµì¬ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="addBookModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">êµì¬ ì¶”ê°€</h3>
                <button class="modal-close" onclick="closeModal('addBookModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="form-group">
                <label>ê³¼ëª©</label>
                <select id="bookSubject">
                    <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                    <option value="êµ­ì–´">êµ­ì–´</option>
                    <option value="ìˆ˜í•™">ìˆ˜í•™</option>
                    <option value="ì˜ì–´">ì˜ì–´</option>
                    <option value="ë¬¼ë¦¬">ë¬¼ë¦¬</option>
                    <option value="í™”í•™">í™”í•™</option>
                    <option value="ìƒëª…">ìƒëª…ê³¼í•™</option>
                    <option value="ì§€êµ¬ê³¼í•™">ì§€êµ¬ê³¼í•™</option>
                    <option value="í•œêµ­ì‚¬">í•œêµ­ì‚¬</option>
                    <option value="ì‚¬íšŒíƒêµ¬">ì‚¬íšŒíƒêµ¬</option>
                </select>
            </div>
            <div class="form-group">
                <label>êµì¬ëª…</label>
                <input type="text" id="bookName" placeholder="ì˜ˆ: ìˆ˜íŠ¹ ë…ì„œ, ìì´ìŠ¤í† ë¦¬">
            </div>
            <button class="btn btn-primary" onclick="addBook()"><i class="fas fa-plus"></i> ì¶”ê°€í•˜ê¸°</button>
        </div>
    </div>

    <!-- ê³„íš ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="addPlanModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ê³„íš ì¶”ê°€</h3>
                <button class="modal-close" onclick="closeModal('addPlanModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="form-group">
                <label>ë‚ ì§œ</label>
                <select id="planDate"></select>
            </div>
            <div class="form-group">
                <label>êµì¬ ì„ íƒ</label>
                <select id="planBook"><option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option></select>
            </div>
            <div class="form-group">
                <label>ê³„íš í˜ì´ì§€ (ì„ íƒ)</label>
                <div class="input-row">
                    <input type="text" id="planStartPage" placeholder="ì‹œì‘ í˜ì´ì§€">
                    <input type="text" id="planEndPage" placeholder="ë í˜ì´ì§€">
                </div>
            </div>
            <button class="btn btn-primary" onclick="addPlan()"><i class="fas fa-plus"></i> ì¶”ê°€í•˜ê¸°</button>
        </div>
    </div>

    <!-- ì‹¤ì²œ ê¸°ë¡ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="recordModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ì‹¤ì²œ ê¸°ë¡</h3>
                <button class="modal-close" onclick="closeModal('recordModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="form-group"><label id="recordBookLabel">ìˆ˜íŠ¹ ë…ì„œ</label></div>
            <div class="input-row">
                <div class="form-group"><label>ì‹œì‘ í˜ì´ì§€</label><input type="number" id="recordStartPage" placeholder="ì˜ˆ: 9"></div>
                <div class="form-group"><label>ë í˜ì´ì§€</label><input type="number" id="recordEndPage" placeholder="ì˜ˆ: 15"></div>
            </div>
            <div class="form-group"><label>ì‹¤ì œ ê³µë¶€ ì‹œê°„ (ë¶„)</label><input type="number" id="recordTime" placeholder="ì˜ˆ: 55"></div>
            <div class="form-group"><label>ë¹„ê³  (ì„ íƒ)</label><input type="text" id="recordNote" placeholder="ë©”ëª¨ê°€ ìˆë‹¤ë©´ ì…ë ¥í•˜ì„¸ìš”"></div>
            <button class="btn btn-success" onclick="saveRecord()"><i class="fas fa-hand-paper"></i> ê²€ì‚¬ ìš”ì²­</button>
        </div>
    </div>

    <!-- ì£¼ê°„ ëª©í‘œ ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal-overlay" id="editGoalModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ì´ë²ˆ ì£¼ ëª©í‘œ ì„¤ì •</h3>
                <button class="modal-close" onclick="closeModal('editGoalModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="form-group">
                <label>ëª©í‘œ 1</label>
                <input type="text" id="weekGoal1" placeholder="ì˜ˆ: ìˆ˜íŠ¹ ì˜ì–´ ëë‚´ê¸°">
            </div>
            <div class="form-group">
                <label>ëª©í‘œ 2</label>
                <input type="text" id="weekGoal2" placeholder="ì˜ˆ: êµ­ì–´ ë°±ë¬¸ì¼ë‹µ ëë‚´ê¸°">
            </div>
            <div class="form-group">
                <label>ëª©í‘œ 3 (ì„ íƒ)</label>
                <input type="text" id="weekGoal3" placeholder="ì˜ˆ: ìˆ˜í•™ 50ë¬¸ì œ í’€ê¸°">
            </div>
            <button class="btn btn-primary" onclick="saveWeekGoal()"><i class="fas fa-save"></i> ì €ì¥í•˜ê¸°</button>
        </div>
    </div>

    <!-- ì›”ê°„ ëª©í‘œ ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal-overlay" id="editMonthGoalModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ì´ë²ˆ ë‹¬ ëª©í‘œ ì„¤ì •</h3>
                <button class="modal-close" onclick="closeModal('editMonthGoalModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="form-group">
                <label>ì›”ê°„ ëª©í‘œ</label>
                <textarea id="monthGoalText" rows="4" placeholder="ì´ë²ˆ ë‹¬ ëª©í‘œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”"></textarea>
            </div>
            <div class="form-group">
                <label>ëª©í‘œ ê³µë¶€ì‹œê°„ (ì‹œê°„)</label>
                <input type="number" id="monthGoalHours" placeholder="ì˜ˆ: 100">
            </div>
            <div class="form-group">
                <label>ëª©í‘œ ì‹¤ì²œìœ¨ (%)</label>
                <input type="number" id="monthGoalRate" placeholder="ì˜ˆ: 85">
            </div>
            <button class="btn btn-primary" onclick="saveMonthGoal()"><i class="fas fa-save"></i> ì €ì¥í•˜ê¸°</button>
        </div>
    </div>

    <!-- ê³„íš ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="planDetailModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="planDetailTitle">ê³„íš ìƒì„¸</h3>
                <button class="modal-close" onclick="closeModal('planDetailModal')"><i class="fas fa-times"></i></button>
            </div>
            <div id="planDetailContent"></div>
            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                <button class="btn btn-danger btn-sm" onclick="deletePlan()" style="flex: 1;"><i class="fas fa-trash"></i> ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

    <!-- ìŠ¤í†±ì›Œì¹˜ í™”ë©´ -->
    <div class="stopwatch-container" id="stopwatchScreen">
        <div class="stopwatch-subject" id="swSubject">ìˆ˜í•™</div>
        <div class="stopwatch-book" id="swBook">ìì´ìŠ¤í† ë¦¬</div>
        <div class="stopwatch-display" id="swDisplay">00:00</div>
        <div class="stopwatch-seconds" id="swSeconds">:00</div>
        <div class="stopwatch-status">
            <div class="status-dot" id="swStatusDot"></div>
            <span class="status-text" id="swStatusText">ê³µë¶€ ì¤‘...</span>
        </div>
        <div class="stopwatch-buttons">
            <button class="sw-btn sw-btn-cancel" onclick="cancelStopwatch()" title="ì·¨ì†Œ"><i class="fas fa-times"></i></button>
            <button class="sw-btn sw-btn-pause" id="swPauseBtn" onclick="toggleStopwatch()"><i class="fas fa-pause" id="swPauseIcon"></i></button>
            <button class="sw-btn sw-btn-stop" onclick="stopStopwatch()" title="ì¢…ë£Œ"><i class="fas fa-stop"></i></button>
        </div>
        <div class="stopwatch-info">ì¢…ë£Œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê³µë¶€ ì‹œê°„ì´ ìë™ìœ¼ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤</div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwGFbsj8FgFIuF-iFkJ4ekyS76MWQf9UrUysJ-Fs12vuVByJwenoYRgOJeOZiPOa6gzkg/exec';

        let currentUser = null;
        let userBooks = [];
        let userPlans = [];
        let currentWeekStart = getMonday(new Date());
        let recordDate = new Date();
        let currentRecordPlan = null;
        let calendarMonth = new Date();
        let weekGoals = {};
        let monthGoals = {};
        let currentPlanDetail = null;

        // ìŠ¤í†±ì›Œì¹˜ ë³€ìˆ˜
        let swInterval = null;
        let swStartTime = null;
        let swElapsedTime = 0;
        let swPausedTime = 0;
        let swIsRunning = false;
        let swCurrentPlan = null;

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function getMonday(d) {
            const date = new Date(d);
            const day = date.getDay();
            const diff = date.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(date.setDate(diff));
        }

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDateKR(date) {
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }

        function getDayName(dayIndex) {
            return ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'][dayIndex];
        }

        // API í˜¸ì¶œ
        async function apiCall(data) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(data)
                });
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                return { success: false, error: error.message };
            }
        }

        // ë¡œê·¸ì¸ ê´€ë ¨
        async function loadStudentsByFloor() {
            const floor = document.getElementById('loginFloor').value;
            const nameSelect = document.getElementById('loginName');
            if (!floor) {
                nameSelect.innerHTML = '<option value="">ì¸µì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”</option>';
                return;
            }
            nameSelect.innerHTML = '<option value="">ë¡œë”©ì¤‘...</option>';
            const result = await apiCall({ action: 'getStudents', floor: floor });
            if (result.success) {
                nameSelect.innerHTML = '<option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>';
                result.students.forEach(s => {
                    nameSelect.innerHTML += `<option value="${s.name}">${s.name}</option>`;
                });
            }
        }

        async function login() {
            const floor = document.getElementById('loginFloor').value;
            const name = document.getElementById('loginName').value;
            if (!floor || !name) {
                showToast('ì¸µê³¼ ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }
            currentUser = { floor, name };
            document.getElementById('headerUserName').textContent = name;
            document.getElementById('headerAvatar').textContent = name.charAt(0);
            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('homeScreen').classList.add('active');
            document.getElementById('mainHeader').style.display = 'block';
            document.getElementById('bottomNav').style.display = 'block';
            
            await loadUserData();
            updateTodayDate();
            updateHomeStats();
        }

        function logout() {
            currentUser = null;
            userBooks = [];
            userPlans = [];
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('bottomNav').style.display = 'none';
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('loginScreen').classList.add('active');
        }

        async function loadUserData() {
            // êµì¬ ë¡œë“œ
            const booksResult = await apiCall({ action: 'getBooks', floor: currentUser.floor, name: currentUser.name });
            if (booksResult.success) userBooks = booksResult.books || [];
            
            // ê³„íš ë¡œë“œ
            await loadWeekPlans();
            
            // ëª©í‘œ ë¡œë“œ
            await loadGoals();
        }

        // êµì¬ ê´€ë¦¬
        function renderBookList() {
            const list = document.getElementById('bookList');
            if (!userBooks || userBooks.length === 0) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-book"></i><p>ë“±ë¡ëœ êµì¬ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }
            list.innerHTML = userBooks.map((book, index) => {
                const badgeClass = getBadgeClass(book.subject);
                return `<div class="book-item">
                    <div class="book-info">
                        <h4>${book.name}</h4>
                        <p><span class="subject-badge ${badgeClass}">${book.subject}</span></p>
                    </div>
                    <div class="book-actions">
                        <button class="delete-btn" onclick="deleteBook(${index})" title="ì‚­ì œ">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>`;
            }).join('');
        }

        function getBadgeClass(subject) {
            const map = {
                'êµ­ì–´': 'badge-korean',
                'ìˆ˜í•™': 'badge-math',
                'ì˜ì–´': 'badge-english',
                'ë¬¼ë¦¬': 'badge-science',
                'í™”í•™': 'badge-science',
                'ìƒëª…': 'badge-science',
                'ì§€êµ¬ê³¼í•™': 'badge-science',
                'í•œêµ­ì‚¬': 'badge-social',
                'ì‚¬íšŒíƒêµ¬': 'badge-social'
            };
            return map[subject] || 'badge-korean';
        }

        async function addBook() {
            const subject = document.getElementById('bookSubject').value;
            const name = document.getElementById('bookName').value.trim();
            if (!subject || !name) {
                showToast('ê³¼ëª©ê³¼ êµì¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            const result = await apiCall({
                action: 'addBook',
                floor: currentUser.floor,
                name: currentUser.name,
                subject: subject,
                bookName: name
            });
            if (result.success) {
                userBooks.push({ subject, name });
                closeModal('addBookModal');
                renderBookList();
                showToast('êµì¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
                document.getElementById('bookSubject').value = '';
                document.getElementById('bookName').value = '';
            }
        }

        async function deleteBook(index) {
            if (!confirm('ì´ êµì¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const book = userBooks[index];
            const result = await apiCall({
                action: 'deleteBook',
                floor: currentUser.floor,
                name: currentUser.name,
                subject: book.subject,
                bookName: book.name
            });
            if (result.success) {
                userBooks.splice(index, 1);
                renderBookList();
                showToast('êµì¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            } else {
                showToast('ì‚­ì œ ì‹¤íŒ¨');
            }
        }

        // ì£¼ê°„ ê³„íš
        async function loadWeekPlans() {
            const weekDates = getWeekDates(currentWeekStart);
            const startDate = formatDate(weekDates[0]);
            const endDate = formatDate(weekDates[6]);
            
            const result = await apiCall({
                action: 'getWeekPlans',
                floor: currentUser.floor,
                name: currentUser.name,
                startDate: startDate,
                endDate: endDate
            });
            
            if (result.success) {
                userPlans = result.plans || [];
            }
        }

        function getWeekDates(monday) {
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const d = new Date(monday);
                d.setDate(monday.getDate() + i);
                dates.push(d);
            }
            return dates;
        }

        async function initPlanScreen() {
            await loadWeekPlans();
            renderWeeklyTable();
            updateWeekHeader();
            updatePlanDateSelect();
            updatePlanBookSelect();
            renderWeekGoal();
        }

        function updateWeekHeader() {
            const weekDates = getWeekDates(currentWeekStart);
            const month = weekDates[0].getMonth() + 1;
            const weekNum = Math.ceil(weekDates[0].getDate() / 7);
            
            document.getElementById('weekTitle').textContent = `${month}ì›” ${weekNum}ì£¼ì°¨`;
            document.getElementById('weekRange').textContent = 
                `${formatDateKR(weekDates[0])}(ì›”) ~ ${formatDateKR(weekDates[6])}(ì¼)`;
            
            // í—¤ë” ë‚ ì§œ ì—…ë°ì´íŠ¸
            const today = formatDate(new Date());
            for (let i = 0; i < 7; i++) {
                const th = document.getElementById(`dayHeader${i}`);
                const date = weekDates[i];
                const isToday = formatDate(date) === today;
                const isSat = i === 5;
                const isSun = i === 6;
                
                let className = 'day-header';
                if (isToday) className += ' today';
                if (isSat) className += ' sat';
                if (isSun) className += ' sun';
                
                th.innerHTML = `<div class="${className}">
                    <span class="day-name">${getDayName(i)}</span>
                    <span class="day-date">${date.getDate()}</span>
                </div>`;
            }
        }

        function renderWeeklyTable() {
            const tbody = document.getElementById('weeklyTableBody');
            const weekDates = getWeekDates(currentWeekStart);
            
            // êµì¬ë³„ë¡œ ê·¸ë£¹í™”
            const bookGroups = {};
            userBooks.forEach(book => {
                const key = `${book.subject}|${book.name}`;
                if (!bookGroups[key]) {
                    bookGroups[key] = { subject: book.subject, name: book.name };
                }
            });
            
            // ê³„íšì—ì„œ êµì¬ ì¶”ê°€
            userPlans.forEach(plan => {
                const key = `${plan.subject}|${plan.book}`;
                if (!bookGroups[key]) {
                    bookGroups[key] = { subject: plan.subject, name: plan.book };
                }
            });
            
            if (Object.keys(bookGroups).length === 0) {
                tbody.innerHTML = `<tr><td colspan="9" style="text-align: center; padding: 2rem; color: var(--gray-400);">
                    <i class="fas fa-book" style="font-size: 2rem; margin-bottom: 0.5rem; display: block;"></i>
                    ë¨¼ì € êµì¬ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”
                </td></tr>`;
                return;
            }
            
            // ê³¼ëª©ë³„ë¡œ ì •ë ¬
            const sortedBooks = Object.values(bookGroups).sort((a, b) => {
                const order = ['êµ­ì–´', 'ìˆ˜í•™', 'ì˜ì–´', 'ë¬¼ë¦¬', 'í™”í•™', 'ìƒëª…', 'ì§€êµ¬ê³¼í•™', 'í•œêµ­ì‚¬', 'ì‚¬íšŒíƒêµ¬'];
                return order.indexOf(a.subject) - order.indexOf(b.subject);
            });
            
            tbody.innerHTML = sortedBooks.map(book => {
                let cells = `<td>${book.subject}</td><td>${book.name}</td>`;
                
                for (let i = 0; i < 7; i++) {
                    const dateStr = formatDate(weekDates[i]);
                    const dayPlans = userPlans.filter(p => 
                        p.date === dateStr && p.subject === book.subject && p.book === book.name
                    );
                    
                    if (dayPlans.length > 0) {
                        cells += `<td><div class="cell-content">`;
                        dayPlans.forEach(plan => {
                            let statusClass = '';
                            let statusIcon = '';
                            if (plan.status === 'approved' || plan.status === 'O') {
                                statusClass = 'completed';
                                statusIcon = '<span class="status-icon" style="color: var(--success);">âœ“</span>';
                            } else if (plan.status === 'failed' || plan.status === 'X') {
                                statusClass = 'failed';
                                statusIcon = '<span class="status-icon" style="color: var(--danger);">âœ—</span>';
                            } else if (plan.status === 'requested') {
                                statusClass = 'pending';
                                statusIcon = '<span class="status-icon" style="color: var(--warning);">â³</span>';
                            }
                            
                            const pages = plan.startPage && plan.endPage ? 
                                `<div class="pages">p.${plan.startPage}~${plan.endPage}</div>` : 
                                (plan.planPages ? `<div class="pages">${plan.planPages}</div>` : '');
                            
                            cells += `<div class="cell-plan ${statusClass}" onclick="openPlanDetail('${plan.subject}', '${plan.book}', '${dateStr}')">
                                ${statusIcon}
                                <div>O</div>
                                ${pages}
                            </div>`;
                        });
                        cells += `</div></td>`;
                    } else {
                        cells += `<td>
                            <button class="cell-add" onclick="quickAddPlan('${book.subject}', '${book.name}', '${dateStr}')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </td>`;
                    }
                }
                
                return `<tr>${cells}</tr>`;
            }).join('');
        }

        async function quickAddPlan(subject, bookName, dateStr) {
            const result = await apiCall({
                action: 'addPlan',
                floor: currentUser.floor,
                name: currentUser.name,
                date: dateStr,
                subject: subject,
                bookName: bookName,
                time: 60
            });
            
            if (result.success) {
                userPlans.push({
                    date: dateStr,
                    subject: subject,
                    book: bookName,
                    status: 'pending'
                });
                renderWeeklyTable();
                showToast('ê³„íšì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        function openPlanDetail(subject, book, date) {
            currentPlanDetail = { subject, book, date };
            const plan = userPlans.find(p => p.subject === subject && p.book === book && p.date === date);
            
            document.getElementById('planDetailTitle').textContent = `${subject} - ${book}`;
            
            let statusText = 'ëŒ€ê¸°ì¤‘';
            if (plan.status === 'approved' || plan.status === 'O') statusText = 'âœ… ìŠ¹ì¸ ì™„ë£Œ';
            else if (plan.status === 'failed' || plan.status === 'X') statusText = 'âŒ ë¯¸ì™„ë£Œ';
            else if (plan.status === 'requested') statusText = 'â³ ê²€ì‚¬ ëŒ€ê¸°';
            
            document.getElementById('planDetailContent').innerHTML = `
                <p><strong>ë‚ ì§œ:</strong> ${date}</p>
                <p><strong>ìƒíƒœ:</strong> ${statusText}</p>
                ${plan.startPage ? `<p><strong>í˜ì´ì§€:</strong> p.${plan.startPage} ~ p.${plan.endPage}</p>` : ''}
                ${plan.actualTime ? `<p><strong>ê³µë¶€ì‹œê°„:</strong> ${plan.actualTime}ë¶„</p>` : ''}
            `;
            
            openModal('planDetailModal');
        }

        async function deletePlan() {
            if (!currentPlanDetail) return;
            if (!confirm('ì´ ê³„íšì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const result = await apiCall({
                action: 'deletePlan',
                floor: currentUser.floor,
                name: currentUser.name,
                date: currentPlanDetail.date,
                subject: currentPlanDetail.subject,
                bookName: currentPlanDetail.book
            });
            
            if (result.success) {
                userPlans = userPlans.filter(p => 
                    !(p.subject === currentPlanDetail.subject && 
                      p.book === currentPlanDetail.book && 
                      p.date === currentPlanDetail.date)
                );
                closeModal('planDetailModal');
                renderWeeklyTable();
                showToast('ê³„íšì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        function changeWeek(delta) {
            currentWeekStart.setDate(currentWeekStart.getDate() + (delta * 7));
            initPlanScreen();
        }

        function updatePlanDateSelect() {
            const select = document.getElementById('planDate');
            const weekDates = getWeekDates(currentWeekStart);
            select.innerHTML = weekDates.map((d, i) => 
                `<option value="${formatDate(d)}">${formatDateKR(d)} (${getDayName(i)})</option>`
            ).join('');
        }

        function updatePlanBookSelect() {
            const select = document.getElementById('planBook');
            select.innerHTML = '<option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>';
            userBooks.forEach(book => {
                select.innerHTML += `<option value="${book.subject}|${book.name}">[${book.subject}] ${book.name}</option>`;
            });
        }

        async function addPlan() {
            const date = document.getElementById('planDate').value;
            const bookValue = document.getElementById('planBook').value;
            if (!bookValue) {
                showToast('êµì¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }
            const [subject, bookName] = bookValue.split('|');
            const startPage = document.getElementById('planStartPage').value;
            const endPage = document.getElementById('planEndPage').value;
            
            const result = await apiCall({
                action: 'addPlan',
                floor: currentUser.floor,
                name: currentUser.name,
                date: date,
                subject: subject,
                bookName: bookName,
                time: 60,
                startPage: startPage,
                endPage: endPage
            });
            
            if (result.success) {
                userPlans.push({
                    date: date,
                    subject: subject,
                    book: bookName,
                    status: 'pending',
                    planPages: startPage && endPage ? `p.${startPage}~${endPage}` : ''
                });
                closeModal('addPlanModal');
                renderWeeklyTable();
                showToast('ê³„íšì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
                document.getElementById('planStartPage').value = '';
                document.getElementById('planEndPage').value = '';
            }
        }

        // ì£¼ê°„ ëª©í‘œ
        async function loadGoals() {
            const result = await apiCall({
                action: 'getGoals',
                floor: currentUser.floor,
                name: currentUser.name
            });
            if (result.success) {
                weekGoals = result.weekGoals || {};
                monthGoals = result.monthGoals || {};
            }
        }

        function renderWeekGoal() {
            const weekKey = formatDate(currentWeekStart);
            const goals = weekGoals[weekKey] || {};
            const content = document.getElementById('weekGoalContent');
            
            if (goals.goal1 || goals.goal2 || goals.goal3) {
                let html = '';
                if (goals.goal1) html += `<p>1. ${goals.goal1}</p>`;
                if (goals.goal2) html += `<p>2. ${goals.goal2}</p>`;
                if (goals.goal3) html += `<p>3. ${goals.goal3}</p>`;
                content.innerHTML = html;
            } else {
                content.innerHTML = '<p>ëª©í‘œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!</p>';
            }
        }

        async function saveWeekGoal() {
            const weekKey = formatDate(currentWeekStart);
            const goal1 = document.getElementById('weekGoal1').value.trim();
            const goal2 = document.getElementById('weekGoal2').value.trim();
            const goal3 = document.getElementById('weekGoal3').value.trim();
            
            const result = await apiCall({
                action: 'saveWeekGoal',
                floor: currentUser.floor,
                name: currentUser.name,
                weekKey: weekKey,
                goal1: goal1,
                goal2: goal2,
                goal3: goal3
            });
            
            if (result.success) {
                weekGoals[weekKey] = { goal1, goal2, goal3 };
                closeModal('editGoalModal');
                renderWeekGoal();
                showToast('ëª©í‘œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        async function saveMonthGoal() {
            const monthKey = `${calendarMonth.getFullYear()}-${calendarMonth.getMonth() + 1}`;
            const goalText = document.getElementById('monthGoalText').value.trim();
            const goalHours = document.getElementById('monthGoalHours').value;
            const goalRate = document.getElementById('monthGoalRate').value;
            
            const result = await apiCall({
                action: 'saveMonthGoal',
                floor: currentUser.floor,
                name: currentUser.name,
                monthKey: monthKey,
                goalText: goalText,
                goalHours: goalHours,
                goalRate: goalRate
            });
            
            if (result.success) {
                monthGoals[monthKey] = { goalText, goalHours, goalRate };
                closeModal('editMonthGoalModal');
                renderGoalScreen();
                showToast('ëª©í‘œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        // ì‹¤ì²œ ê¸°ë¡
        async function initRecordScreen() {
            document.getElementById('recordDateDisplay').textContent = 
                recordDate.toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' });
            await loadRecords();
        }

        async function loadRecords() {
            const result = await apiCall({
                action: 'getRecords',
                floor: currentUser.floor,
                name: currentUser.name,
                date: formatDate(recordDate)
            });
            if (result.success) renderRecordList(result.records);
        }

        function renderRecordList(records) {
            const list = document.getElementById('recordList');
            if (!records || records.length === 0) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-clipboard-list"></i><p>ì´ ë‚ ì˜ ê³„íšì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }
            
            list.innerHTML = records.map(plan => {
                let statusText = '';
                let showButtons = false;
                
                if (plan.status === 'pending' || !plan.status) {
                    statusText = '<span style="color: var(--gray-400);">ëŒ€ê¸°ì¤‘</span>';
                    showButtons = true;
                } else if (plan.status === 'requested') {
                    statusText = '<span style="color: var(--warning);"><i class="fas fa-clock"></i> ê²€ì‚¬ ëŒ€ê¸°</span>';
                } else if (plan.status === 'approved' || plan.status === 'O') {
                    statusText = '<span style="color: var(--success);"><i class="fas fa-check-circle"></i> ìŠ¹ì¸ ì™„ë£Œ</span>';
                } else if (plan.status === 'failed' || plan.status === 'X') {
                    statusText = '<span style="color: var(--danger);"><i class="fas fa-times"></i> ë¯¸ì™„ë£Œ</span>';
                }
                
                return `<div class="plan-item ${plan.status}">
                    <div class="plan-header">
                        <div>
                            <div class="plan-title">${plan.book}</div>
                            <div class="plan-subtitle">${plan.subject}</div>
                        </div>
                        ${statusText}
                    </div>
                    ${showButtons ? `<div class="plan-actions">
                        <button class="plan-btn timer" onclick="startStopwatch('${plan.subject}', '${plan.book}')"><i class="fas fa-stopwatch"></i> íƒ€ì´ë¨¸</button>
                        <button class="plan-btn complete" onclick="openRecordModal('${plan.subject}', '${plan.book}')"><i class="fas fa-hand-paper"></i> ì§ì ‘ì…ë ¥</button>
                        <button class="plan-btn fail" onclick="markFailed('${plan.subject}', '${plan.book}')"><i class="fas fa-times"></i> ë¯¸ì™„ë£Œ</button>
                    </div>` : ''}
                </div>`;
            }).join('');
        }

        async function changeRecordDate(delta) {
            recordDate.setDate(recordDate.getDate() + delta);
            await initRecordScreen();
        }

        function openRecordModal(subject, book) {
            currentRecordPlan = { subject, book };
            document.getElementById('recordBookLabel').textContent = `[${subject}] ${book}`;
            openModal('recordModal');
        }

        async function saveRecord() {
            const time = parseInt(document.getElementById('recordTime').value) || 0;
            if (!time) {
                showToast('ê³µë¶€ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            const result = await apiCall({
                action: 'requestCheck',
                floor: currentUser.floor,
                name: currentUser.name,
                date: formatDate(recordDate),
                subject: currentRecordPlan.subject,
                bookName: currentRecordPlan.book,
                startPage: document.getElementById('recordStartPage').value,
                endPage: document.getElementById('recordEndPage').value,
                actualTime: time,
                note: document.getElementById('recordNote').value
            });
            
            if (result.success) {
                closeModal('recordModal');
                await loadRecords();
                showToast('ê²€ì‚¬ ìš”ì²­ ì™„ë£Œ!');
                document.getElementById('recordStartPage').value = '';
                document.getElementById('recordEndPage').value = '';
                document.getElementById('recordTime').value = '';
                document.getElementById('recordNote').value = '';
            }
        }

        async function markFailed(subject, book) {
            if (!confirm('ë¯¸ì™„ë£Œë¡œ ê¸°ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const result = await apiCall({
                action: 'markFailed',
                floor: currentUser.floor,
                name: currentUser.name,
                date: formatDate(recordDate),
                subject: subject,
                bookName: book
            });
            
            if (result.success) {
                await loadRecords();
                showToast('ë¯¸ì™„ë£Œë¡œ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        // ìŠ¤í†±ì›Œì¹˜
        function startStopwatch(subject, book) {
            swCurrentPlan = { subject, book };
            document.getElementById('swSubject').textContent = subject;
            document.getElementById('swBook').textContent = book;
            document.getElementById('swDisplay').textContent = '00:00';
            document.getElementById('swSeconds').textContent = ':00';
            document.getElementById('stopwatchScreen').classList.add('active');
            
            swStartTime = Date.now();
            swElapsedTime = 0;
            swPausedTime = 0;
            swIsRunning = true;
            
            document.getElementById('swStatusDot').classList.remove('paused');
            document.getElementById('swStatusText').textContent = 'ê³µë¶€ ì¤‘...';
            document.getElementById('swPauseIcon').className = 'fas fa-pause';
            document.getElementById('swPauseBtn').className = 'sw-btn sw-btn-pause';
            
            swInterval = setInterval(updateStopwatchDisplay, 1000);
        }

        function updateStopwatchDisplay() {
            if (!swIsRunning) return;
            
            const elapsed = Math.floor((Date.now() - swStartTime - swPausedTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            document.getElementById('swDisplay').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('swSeconds').textContent = `:${String(seconds).padStart(2, '0')}`;
            
            swElapsedTime = elapsed;
        }

        function toggleStopwatch() {
            if (swIsRunning) {
                swIsRunning = false;
                swPausedTime += Date.now() - swStartTime - swPausedTime - (swElapsedTime * 1000);
                document.getElementById('swStatusDot').classList.add('paused');
                document.getElementById('swStatusText').textContent = 'ì¼ì‹œì •ì§€';
                document.getElementById('swPauseIcon').className = 'fas fa-play';
                document.getElementById('swPauseBtn').className = 'sw-btn sw-btn-play';
            } else {
                swIsRunning = true;
                swStartTime = Date.now() - (swElapsedTime * 1000);
                document.getElementById('swStatusDot').classList.remove('paused');
                document.getElementById('swStatusText').textContent = 'ê³µë¶€ ì¤‘...';
                document.getElementById('swPauseIcon').className = 'fas fa-pause';
                document.getElementById('swPauseBtn').className = 'sw-btn sw-btn-pause';
            }
        }

        function cancelStopwatch() {
            if (confirm('íƒ€ì´ë¨¸ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                clearInterval(swInterval);
                document.getElementById('stopwatchScreen').classList.remove('active');
            }
        }

        function stopStopwatch() {
            clearInterval(swInterval);
            document.getElementById('stopwatchScreen').classList.remove('active');
            
            const minutes = Math.ceil(swElapsedTime / 60);
            currentRecordPlan = swCurrentPlan;
            document.getElementById('recordBookLabel').textContent = `[${swCurrentPlan.subject}] ${swCurrentPlan.book}`;
            document.getElementById('recordTime').value = minutes;
            openModal('recordModal');
        }

        // í†µê³„
        async function initStatsScreen() {
            const result = await apiCall({
                action: 'getStats',
                floor: currentUser.floor,
                name: currentUser.name
            });
            
            if (result.success) {
                const s = result.stats;
                document.getElementById('myTotalPlan').textContent = s.totalPlans || 0;
                document.getElementById('myTotalComplete').textContent = s.completed || 0;
                document.getElementById('myTotalTime').textContent = (s.totalTimeHours || 0) + 'h';
                document.getElementById('myTotalPoint').textContent = s.points || 0;
                document.getElementById('myProgressPercent').textContent = (s.rate || 0) + '%';
                document.getElementById('myProgressFill').style.width = (s.rate || 0) + '%';
            }
            
            const rankResult = await apiCall({ action: 'getRanking' });
            if (rankResult.success) renderRanking(rankResult.rankings);
        }

        function renderRanking(rankings) {
            const list = document.getElementById('rankingList');
            if (!rankings || rankings.length === 0) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-trophy"></i><p>ë­í‚¹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }
            
            list.innerHTML = rankings.map((r, i) => `
                <div class="ranking-item ${i < 3 ? 'top-' + (i + 1) : ''}">
                    <div class="ranking-num">${i + 1}</div>
                    <div class="ranking-info">
                        <div class="ranking-name">${r.name}</div>
                        <div class="ranking-detail">${r.floor} Â· ì‹¤ì²œìœ¨ ${r.rate}%</div>
                    </div>
                    <div class="ranking-score">${r.totalTime}h</div>
                </div>
            `).join('');
        }

        // ìº˜ë¦°ë”
        async function initCalendarScreen() {
            renderCalendar();
            await loadMonthStats();
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const year = calendarMonth.getFullYear();
            const month = calendarMonth.getMonth();
            
            document.getElementById('calendarTitle').textContent = `${year}ë…„ ${month + 1}ì›”`;
            
            // ê¸°ì¡´ ë‚ ì§œ ì œê±°
            const existingDays = grid.querySelectorAll('.calendar-day');
            existingDays.forEach(d => d.remove());
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDay = firstDay.getDay();
            const today = formatDate(new Date());
            
            // ì´ì „ ë‹¬
            const prevLastDay = new Date(year, month, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = prevLastDay - i;
                grid.appendChild(day);
            }
            
            // ì´ë²ˆ ë‹¬
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const day = document.createElement('div');
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                day.className = 'calendar-day';
                if (dateStr === today) day.classList.add('today');
                day.textContent = i;
                day.onclick = () => {
                    recordDate = new Date(dateStr);
                    showScreen('recordScreen');
                };
                grid.appendChild(day);
            }
            
            // ë‹¤ìŒ ë‹¬
            const remaining = 42 - (startDay + lastDay.getDate());
            for (let i = 1; i <= remaining; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = i;
                grid.appendChild(day);
            }
        }

        async function loadMonthStats() {
            const year = calendarMonth.getFullYear();
            const month = calendarMonth.getMonth() + 1;
            
            const result = await apiCall({
                action: 'getMonthStats',
                floor: currentUser.floor,
                name: currentUser.name,
                year: year,
                month: month
            });
            
            if (result.success) {
                document.getElementById('monthPlans').textContent = result.stats.totalPlans || 0;
                document.getElementById('monthComplete').textContent = result.stats.completed || 0;
            }
        }

        function changeCalendarMonth(delta) {
            calendarMonth.setMonth(calendarMonth.getMonth() + delta);
            initCalendarScreen();
        }

        // ëª©í‘œ í™”ë©´
        function renderGoalScreen() {
            const weekKey = formatDate(currentWeekStart);
            const monthKey = `${calendarMonth.getFullYear()}-${calendarMonth.getMonth() + 1}`;
            
            const wGoal = weekGoals[weekKey] || {};
            const mGoal = monthGoals[monthKey] || {};
            
            let weekHtml = '';
            if (wGoal.goal1 || wGoal.goal2 || wGoal.goal3) {
                if (wGoal.goal1) weekHtml += `<p>1. ${wGoal.goal1}</p>`;
                if (wGoal.goal2) weekHtml += `<p>2. ${wGoal.goal2}</p>`;
                if (wGoal.goal3) weekHtml += `<p>3. ${wGoal.goal3}</p>`;
            } else {
                weekHtml = 'ëª©í‘œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!';
            }
            document.getElementById('currentWeekGoal').innerHTML = weekHtml;
            
            let monthHtml = '';
            if (mGoal.goalText || mGoal.goalHours || mGoal.goalRate) {
                if (mGoal.goalText) monthHtml += `<p>${mGoal.goalText}</p>`;
                if (mGoal.goalHours) monthHtml += `<p>ğŸ“š ëª©í‘œ ê³µë¶€ì‹œê°„: ${mGoal.goalHours}ì‹œê°„</p>`;
                if (mGoal.goalRate) monthHtml += `<p>ğŸ“Š ëª©í‘œ ì‹¤ì²œìœ¨: ${mGoal.goalRate}%</p>`;
            } else {
                monthHtml = 'ëª©í‘œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!';
            }
            document.getElementById('currentMonthGoal').innerHTML = monthHtml;
        }

        // í™ˆ í†µê³„
        function updateTodayDate() {
            document.getElementById('todayDate').textContent = 
                new Date().toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'short' });
        }

        async function updateHomeStats() {
            const result = await apiCall({
                action: 'getRecords',
                floor: currentUser.floor,
                name: currentUser.name,
                date: formatDate(new Date())
            });
            
            if (result.success) {
                const records = result.records || [];
                const total = records.length;
                const completed = records.filter(r => r.status === 'approved' || r.status === 'O').length;
                const totalTime = records.filter(r => r.status === 'approved' || r.status === 'O')
                    .reduce((sum, r) => sum + (r.actualTime || 0), 0);
                
                document.getElementById('statPlan').textContent = total;
                document.getElementById('statComplete').textContent = completed;
                document.getElementById('statTime').textContent = (totalTime / 60).toFixed(1) + 'h';
                document.getElementById('statPoint').textContent = completed;
                
                const percent = total > 0 ? Math.round(completed / total * 100) : 0;
                document.getElementById('progressPercent').textContent = percent + '%';
                document.getElementById('progressFill').style.width = percent + '%';
            }
        }

        // í™”ë©´ ì „í™˜
        async function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const navMap = { 'homeScreen': 0, 'planScreen': 1, 'recordScreen': 2, 'statsScreen': 3 };
            if (navMap[screenId] !== undefined) {
                document.querySelectorAll('.nav-item')[navMap[screenId]].classList.add('active');
            }
            
            if (screenId === 'bookScreen') renderBookList();
            if (screenId === 'planScreen') await initPlanScreen();
            if (screenId === 'recordScreen') await initRecordScreen();
            if (screenId === 'statsScreen') await initStatsScreen();
            if (screenId === 'calendarScreen') await initCalendarScreen();
            if (screenId === 'goalScreen') renderGoalScreen();
        }

        // ëª¨ë‹¬ & í† ìŠ¤íŠ¸
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
    </script>
</body>
</html>
