<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì„ ìƒë‹˜ ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            font-size: 12px;
        }

        .header {
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            color: white;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header h1 { font-size: 1rem; }
        .header-right { display: flex; gap: 6px; align-items: center; }
        .floor-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            background: rgba(255,255,255,0.2);
            color: white;
        }
        .floor-btn.active { background: #3b82f6; }
        .refresh-btn {
            padding: 5px 8px;
            border: none;
            border-radius: 5px;
            background: #10b981;
            color: white;
            cursor: pointer;
        }
        .refresh-btn.spinning i { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* ê¸°ê°„ ì„ íƒ ë°” */
        .period-bar {
            background: white;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e0e0e0;
        }
        .period-toggle {
            display: flex;
            background: #f0f0f0;
            border-radius: 6px;
            padding: 2px;
        }
        .period-btn {
            padding: 6px 14px;
            border: none;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            background: transparent;
            color: #666;
        }
        .period-btn.active {
            background: #1e3a5f;
            color: white;
        }
        .period-info {
            font-size: 0.8rem;
            color: #666;
        }

        /* ìš”ì•½ ë°” */
        .summary-bar {
            background: #1e3a5f;
            color: white;
            padding: 10px 15px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .summary-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
        }
        .summary-item .label { opacity: 0.8; }
        .summary-item .value { font-weight: 700; }

        /* íƒ­ */
        .tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #e0e0e0;
        }
        .tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: none;
            font-size: 0.8rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .tab.active {
            color: #1e3a5f;
            border-bottom-color: #1e3a5f;
        }
        .tab .badge {
            background: #ef4444;
            color: white;
            padding: 1px 5px;
            border-radius: 6px;
            font-size: 0.65rem;
            margin-left: 3px;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* ========== í•™ìƒí˜„í™© í…Œì´ë¸” ========== */
        .student-table-container {
            overflow-x: auto;
            background: white;
        }
        .student-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
        }
        .student-table th {
            background: #f8f9fa;
            padding: 6px 4px;
            text-align: center;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
            position: sticky;
            top: 0;
            white-space: nowrap;
        }
        .student-table td {
            padding: 5px 4px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }
        .student-table tr:hover { background: #f8fafc; }
        .student-table .name-cell {
            text-align: left;
            font-weight: 600;
            color: #1e3a5f;
            white-space: nowrap;
            padding-left: 8px;
        }
        .floor-badge {
            font-size: 8px;
            padding: 1px 3px;
            border-radius: 3px;
            margin-left: 2px;
        }
        .floor-7 { background: #dbeafe; color: #1e40af; }
        .floor-8 { background: #fef3c7; color: #92400e; }

        .rate-bar {
            width: 40px;
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
            display: inline-block;
            vertical-align: middle;
        }
        .rate-bar-fill {
            height: 100%;
            border-radius: 6px;
        }
        .rate-high { background: #10b981; }
        .rate-mid { background: #f59e0b; }
        .rate-low { background: #ef4444; }

        .mini-num {
            font-weight: 600;
        }
        .mini-num.green { color: #10b981; }
        .mini-num.orange { color: #f59e0b; }
        .mini-num.red { color: #ef4444; }
        .mini-num.blue { color: #3b82f6; }

        /* ========== ê²€ì‚¬ëŒ€ê¸° ========== */
        .check-list {
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .check-item {
            background: white;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.06);
            border-left: 3px solid #f59e0b;
        }
        .check-item .info { flex: 1; }
        .check-item .name { font-weight: 700; color: #1e3a5f; font-size: 11px; }
        .check-item .detail { font-size: 10px; color: #666; margin-top: 2px; }
        .check-item .page-box {
            background: #fef3c7;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: 700;
            color: #92400e;
            font-size: 10px;
        }
        .check-item .actions { display: flex; gap: 4px; }
        .check-item .btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
        }
        .check-item .btn.approve { background: #10b981; color: white; }
        .check-item .btn.reject { background: #ef4444; color: white; }

        /* ========== í†µê³„ ========== */
        .stats-section { padding: 12px; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        .stat-box {
            background: white;
            border-radius: 8px;
            padding: 12px 8px;
            text-align: center;
        }
        .stat-box.highlight {
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            color: white;
        }
        .stat-box .value { font-size: 1.4rem; font-weight: 800; }
        .stat-box .label { font-size: 0.65rem; opacity: 0.8; margin-top: 2px; }

        .ranking-section {
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        .ranking-title {
            padding: 8px 12px;
            font-weight: 700;
            font-size: 0.85rem;
            color: #1e3a5f;
            border-bottom: 1px solid #f0f0f0;
        }
        .ranking-item {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            border-bottom: 1px solid #f8f8f8;
            font-size: 11px;
        }
        .ranking-item:last-child { border-bottom: none; }
        .rank-num {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 700;
            margin-right: 8px;
        }
        .rank-1 { background: #fef3c7; color: #b45309; }
        .rank-2 { background: #e5e7eb; color: #4b5563; }
        .rank-3 { background: #fed7aa; color: #c2410c; }
        .rank-other { background: #f3f4f6; color: #6b7280; }
        .rank-info { flex: 1; }
        .rank-name { font-weight: 600; }
        .rank-floor { font-size: 9px; color: #888; }
        .rank-value { font-weight: 700; color: #1e3a5f; }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .toast.success { background: #10b981; }
        .toast.error { background: #ef4444; }

        .empty-state {
            text-align: center;
            padding: 30px 20px;
            color: #888;
        }
        .empty-state i { font-size: 1.5rem; margin-bottom: 8px; color: #ddd; }

        .loading-row td { text-align: center; padding: 20px; color: #888; }

        /* ì •ë ¬ ë²„íŠ¼ */
        .sort-bar {
            background: #f8f9fa;
            padding: 6px 10px;
            display: flex;
            gap: 6px;
            align-items: center;
            font-size: 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        .sort-bar span { color: #666; }
        .sort-btn {
            padding: 3px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 9px;
            cursor: pointer;
        }
        .sort-btn.active {
            background: #1e3a5f;
            color: white;
            border-color: #1e3a5f;
        }

        /* ========== í•™ë¶€ëª¨ ë³´ê³ ì„œ ìŠ¤íƒ€ì¼ ========== */
        .report-section {
            padding: 12px;
        }
        .report-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .report-controls select {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
        }
        .report-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            color: white;
        }
        .report-title {
            font-weight: 700;
            font-size: 1rem;
        }
        .copy-btn {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            background: #10b981;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
        }
        .copy-btn:active {
            transform: scale(0.95);
        }
        .report-content {
            padding: 20px;
            background: linear-gradient(180deg, #f8fafc, #ffffff);
        }
        .report-student-info {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px dashed #e0e0e0;
        }
        .report-student-info .student-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1e3a5f;
            margin-bottom: 5px;
        }
        .report-period {
            color: #666;
            font-size: 0.9rem;
        }
        .report-stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .report-stat {
            text-align: center;
            padding: 15px 8px;
            background: #f0f9ff;
            border-radius: 12px;
        }
        .report-stat.highlight {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
        }
        .report-stat .stat-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        .report-stat .stat-value {
            font-size: 1.4rem;
            font-weight: 800;
            color: #1e3a5f;
        }
        .report-stat .stat-label {
            font-size: 0.7rem;
            color: #666;
            margin-top: 3px;
        }
        .report-streak {
            text-align: center;
            padding: 12px;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
        }
        .report-streak strong {
            font-size: 1.3rem;
            color: #92400e;
        }
        .report-subjects {
            margin-bottom: 20px;
        }
        .subject-title, .comment-title, .trend-title, .achievement-title {
            font-weight: 700;
            color: #1e3a5f;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }
        .report-subject-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .report-subject-bar .subj-name {
            width: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #555;
        }
        .report-subject-bar .subj-track {
            flex: 1;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 10px;
        }
        .report-subject-bar .subj-fill {
            height: 100%;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .report-subject-bar .subj-time {
            width: 45px;
            text-align: right;
            font-size: 0.8rem;
            font-weight: 600;
            color: #1e3a5f;
        }
        .report-comment textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            resize: none;
            height: 80px;
            font-family: inherit;
        }
        .report-footer {
            text-align: center;
            padding-top: 15px;
            margin-top: 15px;
            border-top: 2px dashed #e0e0e0;
            color: #888;
            font-size: 0.85rem;
        }
        .report-placeholder {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
        .report-placeholder i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
        }
        .report-placeholder p {
            margin-bottom: 5px;
        }
        .report-placeholder .hint {
            font-size: 0.8rem;
            color: #aaa;
        }
        .report-weekly-trend {
            margin-bottom: 20px;
        }
        .trend-week {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .trend-week .week-label {
            width: 60px;
            font-size: 0.8rem;
            color: #555;
        }
        .trend-week .week-bar {
            flex: 1;
            height: 24px;
            background: #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            margin-right: 10px;
        }
        .trend-week .week-fill {
            height: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .trend-week .week-change {
            width: 40px;
            text-align: right;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .trend-week .week-change.up { color: #10b981; }
        .trend-week .week-change.down { color: #ef4444; }
        .report-achievements {
            margin-bottom: 20px;
        }
        .achievement-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            background: #f0f9ff;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .achievement-item .ach-icon {
            font-size: 1.2rem;
            margin-right: 10px;
        }
        .achievement-item .ach-text {
            flex: 1;
            font-size: 0.85rem;
            color: #333;
        }
        .achievement-item .ach-value {
            font-weight: 700;
            color: #1e3a5f;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ‘©â€ğŸ« ëŒ€ì‹œë³´ë“œ</h1>
        <div class="header-right">
            <button class="floor-btn active" data-floor="" onclick="setFloor('')">ì „ì²´</button>
            <button class="floor-btn" data-floor="7ì¸µ" onclick="setFloor('7ì¸µ')">7ì¸µ</button>
            <button class="floor-btn" data-floor="8ì¸µ" onclick="setFloor('8ì¸µ')">8ì¸µ</button>
            <button class="refresh-btn" id="refreshBtn" onclick="loadData()">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>

    <div class="period-bar">
        <div class="period-toggle">
            <button class="period-btn" onclick="setPeriod('today')">ì˜¤ëŠ˜</button>
            <button class="period-btn active" onclick="setPeriod('week')">ì´ë²ˆì£¼</button>
        </div>
        <div class="period-info" id="periodInfo">1/20(ì›”) ~ 1/26(ì¼)</div>
    </div>

    <div class="summary-bar" id="summaryBar">
        <div class="summary-item">
            <span class="label">í•™ìƒ</span>
            <span class="value" id="sumStudents">0</span>
        </div>
        <div class="summary-item">
            <span class="label">ê³„íš</span>
            <span class="value" id="sumPlans">0</span>
        </div>
        <div class="summary-item">
            <span class="label">ì™„ë£Œ</span>
            <span class="value" id="sumCompleted">0</span>
        </div>
        <div class="summary-item">
            <span class="label">ëŒ€ê¸°</span>
            <span class="value" id="sumPending">0</span>
        </div>
        <div class="summary-item">
            <span class="label">í•™ìŠµ</span>
            <span class="value" id="sumTime">0h</span>
        </div>
        <div class="summary-item">
            <span class="label">ì‹¤ì²œìœ¨</span>
            <span class="value" id="sumRate">0%</span>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="switchTab('students')">
            <i class="fas fa-users"></i> í•™ìƒí˜„í™©
        </button>
        <button class="tab" onclick="switchTab('check')">
            <i class="fas fa-bell"></i> ê²€ì‚¬ëŒ€ê¸°
            <span class="badge" id="checkBadge">0</span>
        </button>
        <button class="tab" onclick="switchTab('stats')">
            <i class="fas fa-trophy"></i> ë­í‚¹
        </button>
        <button class="tab" onclick="switchTab('report')">
            <i class="fas fa-file-alt"></i> í•™ë¶€ëª¨ë³´ê³ ì„œ
        </button>
    </div>

    <!-- í•™ìƒí˜„í™© íƒ­ -->
    <div class="tab-content active" id="studentsTab">
        <div class="sort-bar">
            <span>ì •ë ¬:</span>
            <button class="sort-btn active" onclick="setSort('rate')">ì‹¤ì²œìœ¨â†“</button>
            <button class="sort-btn" onclick="setSort('name')">ì´ë¦„ìˆœ</button>
            <button class="sort-btn" onclick="setSort('completed')">ì™„ë£Œâ†“</button>
            <button class="sort-btn" onclick="setSort('time')">ì‹œê°„â†“</button>
        </div>
        <div class="student-table-container">
            <table class="student-table">
                <thead>
                    <tr>
                        <th>ì´ë¦„</th>
                        <th>ê³„íš</th>
                        <th>ì™„ë£Œ</th>
                        <th>ëŒ€ê¸°</th>
                        <th>ì‹œê°„</th>
                        <th>ì‹¤ì²œìœ¨</th>
                    </tr>
                </thead>
                <tbody id="studentTableBody">
                    <tr class="loading-row">
                        <td colspan="6"><i class="fas fa-spinner fa-spin"></i> ë¡œë”© ì¤‘...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ê²€ì‚¬ëŒ€ê¸° íƒ­ -->
    <div class="tab-content" id="checkTab">
        <div class="check-list" id="checkList"></div>
    </div>

    <!-- í†µê³„ íƒ­ -->
    <div class="tab-content" id="statsTab">
        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-box highlight">
                    <div class="value" id="statCompleted">0</div>
                    <div class="label">ì´ ì™„ë£Œ</div>
                </div>
                <div class="stat-box">
                    <div class="value" id="statTime">0h</div>
                    <div class="label">ì´ ì‹œê°„</div>
                </div>
                <div class="stat-box">
                    <div class="value" id="statRate">0%</div>
                    <div class="label">í‰ê·  ì‹¤ì²œìœ¨</div>
                </div>
                <div class="stat-box">
                    <div class="value" id="statActive">0</div>
                    <div class="label">í™œë™ í•™ìƒ</div>
                </div>
            </div>

            <div class="ranking-section">
                <div class="ranking-title">ğŸ† í•™ìŠµì‹œê°„ TOP 10</div>
                <div id="rankingList"></div>
            </div>
        </div>
    </div>

    <!-- í•™ë¶€ëª¨ ë³´ê³ ì„œ íƒ­ -->
    <div class="tab-content" id="reportTab">
        <div class="report-section">
            <!-- í•™ìƒ ì„ íƒ -->
            <div class="report-controls">
                <select id="reportStudent" onchange="loadStudentReport()">
                    <option value="">í•™ìƒ ì„ íƒ</option>
                </select>
                <select id="reportType" onchange="loadStudentReport()">
                    <option value="week">ì£¼ê°„ ë³´ê³ ì„œ</option>
                    <option value="month">ì›”ê°„ ë³´ê³ ì„œ</option>
                </select>
            </div>

            <!-- ì£¼ê°„ ë³´ê³ ì„œ ì¹´ë“œ -->
            <div id="weeklyReportCard" class="report-card" style="display:none;">
                <div class="report-header">
                    <span class="report-title">ğŸ“Š ì£¼ê°„ í•™ìŠµ ë³´ê³ ì„œ</span>
                    <button class="copy-btn" onclick="copyReportImage('weeklyReportCard')">
                        <i class="fas fa-copy"></i> ì´ë¯¸ì§€ ë³µì‚¬
                    </button>
                </div>
                <div class="report-content" id="weeklyReportContent">
                    <div class="report-student-info">
                        <div class="student-name" id="reportStudentName">í™ê¸¸ë™</div>
                        <div class="report-period" id="reportPeriod">2025.1.20(ì›”) ~ 1.26(ì¼)</div>
                    </div>
                    <div class="report-stats-grid">
                        <div class="report-stat">
                            <div class="stat-icon">âœ…</div>
                            <div class="stat-value" id="rptCompleted">0</div>
                            <div class="stat-label">ì™„ë£Œ</div>
                        </div>
                        <div class="report-stat">
                            <div class="stat-icon">ğŸ“</div>
                            <div class="stat-value" id="rptPlanned">0</div>
                            <div class="stat-label">ê³„íš</div>
                        </div>
                        <div class="report-stat">
                            <div class="stat-icon">â±ï¸</div>
                            <div class="stat-value" id="rptTime">0h</div>
                            <div class="stat-label">í•™ìŠµì‹œê°„</div>
                        </div>
                        <div class="report-stat highlight">
                            <div class="stat-icon">ğŸ“ˆ</div>
                            <div class="stat-value" id="rptRate">0%</div>
                            <div class="stat-label">ì‹¤ì²œìœ¨</div>
                        </div>
                    </div>
                    <div class="report-streak">
                        <span>ğŸ”¥ ì—°ì† í•™ìŠµì¼: <strong id="rptStreak">0</strong>ì¼</span>
                    </div>
                    <div class="report-subjects">
                        <div class="subject-title">ğŸ“š ê³¼ëª©ë³„ í•™ìŠµì‹œê°„</div>
                        <div id="rptSubjectBars"></div>
                    </div>
                    <div class="report-comment">
                        <div class="comment-title">ğŸ’¬ ì„ ìƒë‹˜ í•œë§ˆë””</div>
                        <textarea id="rptComment" placeholder="í•™ë¶€ëª¨ë‹˜ê»˜ ì „í•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <div class="report-footer">
                        <span>ê¹€ì—„ë§ˆë…ì„œì‹¤ ğŸ“š</span>
                    </div>
                </div>
            </div>

            <!-- ì›”ê°„ ë³´ê³ ì„œ ì¹´ë“œ -->
            <div id="monthlyReportCard" class="report-card" style="display:none;">
                <div class="report-header">
                    <span class="report-title">ğŸ“Š ì›”ê°„ í•™ìŠµ ë³´ê³ ì„œ</span>
                    <button class="copy-btn" onclick="copyReportImage('monthlyReportCard')">
                        <i class="fas fa-copy"></i> ì´ë¯¸ì§€ ë³µì‚¬
                    </button>
                </div>
                <div class="report-content" id="monthlyReportContent">
                    <div class="report-student-info">
                        <div class="student-name" id="monthStudentName">í™ê¸¸ë™</div>
                        <div class="report-period" id="monthPeriod">2025ë…„ 1ì›”</div>
                    </div>
                    <div class="report-stats-grid">
                        <div class="report-stat">
                            <div class="stat-icon">âœ…</div>
                            <div class="stat-value" id="monthCompleted">0</div>
                            <div class="stat-label">ì´ ì™„ë£Œ</div>
                        </div>
                        <div class="report-stat">
                            <div class="stat-icon">ğŸ“</div>
                            <div class="stat-value" id="monthPlanned">0</div>
                            <div class="stat-label">ì´ ê³„íš</div>
                        </div>
                        <div class="report-stat">
                            <div class="stat-icon">â±ï¸</div>
                            <div class="stat-value" id="monthTime">0h</div>
                            <div class="stat-label">ì´ í•™ìŠµì‹œê°„</div>
                        </div>
                        <div class="report-stat highlight">
                            <div class="stat-icon">ğŸ“ˆ</div>
                            <div class="stat-value" id="monthRate">0%</div>
                            <div class="stat-label">í‰ê·  ì‹¤ì²œìœ¨</div>
                        </div>
                    </div>
                    <div class="report-weekly-trend">
                        <div class="trend-title">ğŸ“ˆ ì£¼ì°¨ë³„ ì‹¤ì²œìœ¨ ì¶”ì´</div>
                        <div id="monthWeeklyTrend"></div>
                    </div>
                    <div class="report-achievements">
                        <div class="achievement-title">ğŸ† ì´ë²ˆ ë‹¬ ì„±ê³¼</div>
                        <div class="achievement-list" id="monthAchievements"></div>
                    </div>
                    <div class="report-subjects">
                        <div class="subject-title">ğŸ“š ê³¼ëª©ë³„ í•™ìŠµì‹œê°„</div>
                        <div id="monthSubjectBars"></div>
                    </div>
                    <div class="report-comment">
                        <div class="comment-title">ğŸ’¬ ì„ ìƒë‹˜ í•œë§ˆë””</div>
                        <textarea id="monthComment" placeholder="í•™ë¶€ëª¨ë‹˜ê»˜ ì „í•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <div class="report-footer">
                        <span>ê¹€ì—„ë§ˆë…ì„œì‹¤ ğŸ“š</span>
                    </div>
                </div>
            </div>

            <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
            <div id="reportPlaceholder" class="report-placeholder">
                <i class="fas fa-file-alt"></i>
                <p>í•™ìƒì„ ì„ íƒí•˜ë©´ ë³´ê³ ì„œê°€ ìƒì„±ë©ë‹ˆë‹¤</p>
                <p class="hint">ì´ë¯¸ì§€ ë³µì‚¬ â†’ ì¹´ì¹´ì˜¤í†¡ì— ë¶™ì—¬ë„£ê¸°</p>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const API = 'https://script.google.com/macros/s/AKfycbwGFbsj8FgFIuF-iFkJ4ekyS76MWQf9UrUysJ-Fs12vuVByJwenoYRgOJeOZiPOa6gzkg/exec';
        
        let currentFloor = '';
        let currentPeriod = 'week';
        let currentSort = 'rate';
        let allStudents = [];
        let waitingList = [];

        document.addEventListener('DOMContentLoaded', () => {
            updatePeriodInfo();
            loadData();
        });

        async function api(params) {
            try {
                const res = await fetch(API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(params)
                });
                return await res.json();
            } catch (err) {
                return { success: false, error: err.toString() };
            }
        }

        function getToday() {
            const now = new Date();
            return formatDate(now);
        }

        function formatDate(d) {
            return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
        }

        function getWeekRange() {
            const now = new Date();
            const day = now.getDay();
            const monday = new Date(now);
            monday.setDate(now.getDate() - (day === 0 ? 6 : day - 1));
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            return { start: formatDate(monday), end: formatDate(sunday), monday, sunday };
        }

        function updatePeriodInfo() {
            const info = document.getElementById('periodInfo');
            if (currentPeriod === 'today') {
                const now = new Date();
                const dayNames = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
                info.textContent = `${now.getMonth()+1}/${now.getDate()}(${dayNames[now.getDay()]})`;
            } else {
                const { monday, sunday } = getWeekRange();
                const dayNames = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
                info.textContent = `${monday.getMonth()+1}/${monday.getDate()}(${dayNames[monday.getDay()]}) ~ ${sunday.getMonth()+1}/${sunday.getDate()}(${dayNames[sunday.getDay()]})`;
            }
        }

        function setFloor(floor) {
            currentFloor = floor;
            document.querySelectorAll('.floor-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.floor === floor);
            });
            renderAll();
        }

        function setPeriod(period) {
            currentPeriod = period;
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === (period === 'today' ? 'ì˜¤ëŠ˜' : 'ì´ë²ˆì£¼'));
            });
            updatePeriodInfo();
            loadData();
        }

        function setSort(sort) {
            currentSort = sort;
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.includes(
                    sort === 'rate' ? 'ì‹¤ì²œìœ¨' : sort === 'name' ? 'ì´ë¦„' : sort === 'completed' ? 'ì™„ë£Œ' : 'ì‹œê°„'
                ));
            });
            renderStudentTable();
        }

        async function loadData() {
            const btn = document.getElementById('refreshBtn');
            btn.classList.add('spinning');

            try {
                if (currentPeriod === 'week') {
                    await loadWeeklyData();
                } else {
                    await loadTodayData();
                }

                // ê²€ì‚¬ ëŒ€ê¸° ëª©ë¡ (í•­ìƒ ë¡œë“œ)
                const pendingRes = await api({ action: 'getPendingRequests', floor: '' });
                waitingList = pendingRes.success ? (pendingRes.requests || []) : [];

                renderAll();
            } catch (err) {
                console.error(err);
                toast('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨', 'error');
            }

            btn.classList.remove('spinning');
        }

        async function loadWeeklyData() {
            const { start, end } = getWeekRange();
            
            // ìƒˆ í•¨ìˆ˜ ì‚¬ìš© ì‹œë„, ì‹¤íŒ¨í•˜ë©´ ê¸°ì¡´ ë°©ì‹
            const res = await api({
                action: 'getWeeklyStudentStatus',
                floor: '',
                weekStart: start,
                weekEnd: end
            });

            if (res.success && res.students) {
                allStudents = res.students;
            } else {
                // ê¸°ì¡´ ë°©ì‹ fallback
                await loadTodayData();
            }
        }

        async function loadTodayData() {
            const today = getToday();
            
            const [dash7, dash8] = await Promise.all([
                api({ action: 'getDashboard', floor: '7ì¸µ' }),
                api({ action: 'getDashboard', floor: '8ì¸µ' })
            ]);

            allStudents = [];
            if (dash7.success && dash7.dashboard?.studentStatus) {
                dash7.dashboard.studentStatus.forEach(s => {
                    allStudents.push({ 
                        ...s, 
                        floor: '7ì¸µ',
                        totalTime: 0,
                        rate: s.planned > 0 ? Math.round(s.completed / s.planned * 100) : 0
                    });
                });
            }
            if (dash8.success && dash8.dashboard?.studentStatus) {
                dash8.dashboard.studentStatus.forEach(s => {
                    allStudents.push({ 
                        ...s, 
                        floor: '8ì¸µ',
                        totalTime: 0,
                        rate: s.planned > 0 ? Math.round(s.completed / s.planned * 100) : 0
                    });
                });
            }
        }

        function getFilteredStudents() {
            if (!currentFloor) return allStudents;
            return allStudents.filter(s => s.floor === currentFloor);
        }

        function getFilteredWaiting() {
            if (!currentFloor) return waitingList;
            return waitingList.filter(w => w.floor === currentFloor);
        }

        function renderAll() {
            renderSummary();
            renderStudentTable();
            renderCheckList();
            renderRanking();
        }

        function renderSummary() {
            const students = getFilteredStudents();
            const waiting = getFilteredWaiting();

            const totalPlans = students.reduce((s, x) => s + (x.planned || 0), 0);
            const totalCompleted = students.reduce((s, x) => s + (x.completed || 0), 0);
            const totalPending = students.reduce((s, x) => s + (x.pending || 0), 0);
            const totalTime = students.reduce((s, x) => s + (x.totalTime || 0), 0);
            const avgRate = students.length > 0 ? Math.round(students.reduce((s, x) => s + (x.rate || 0), 0) / students.length) : 0;

            document.getElementById('sumStudents').textContent = students.length;
            document.getElementById('sumPlans').textContent = totalPlans;
            document.getElementById('sumCompleted').textContent = totalCompleted;
            document.getElementById('sumPending').textContent = totalPending;
            document.getElementById('sumTime').textContent = (totalTime / 60).toFixed(1) + 'h';
            document.getElementById('sumRate').textContent = avgRate + '%';
            document.getElementById('checkBadge').textContent = waiting.length;
        }

        function renderStudentTable() {
            const tbody = document.getElementById('studentTableBody');
            let students = getFilteredStudents();

            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="padding:30px;color:#888;">í•™ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            // ì •ë ¬
            const sorted = [...students].sort((a, b) => {
                switch (currentSort) {
                    case 'name': return a.name.localeCompare(b.name, 'ko');
                    case 'completed': return (b.completed || 0) - (a.completed || 0);
                    case 'time': return (b.totalTime || 0) - (a.totalTime || 0);
                    case 'rate':
                    default: return (b.rate || 0) - (a.rate || 0);
                }
            });

            tbody.innerHTML = sorted.map(s => {
                const planned = s.planned || 0;
                const completed = s.completed || 0;
                const pending = s.pending || 0;
                const totalTime = s.totalTime || 0;
                const rate = s.rate || 0;
                
                const rateClass = rate >= 80 ? 'rate-high' : rate >= 50 ? 'rate-mid' : 'rate-low';
                const floorClass = s.floor === '7ì¸µ' ? 'floor-7' : 'floor-8';
                const timeStr = totalTime >= 60 ? (totalTime / 60).toFixed(1) + 'h' : totalTime + 'm';

                return `
                <tr>
                    <td class="name-cell">
                        ${s.name} <span class="floor-badge ${floorClass}">${s.floor}</span>
                    </td>
                    <td>${planned}</td>
                    <td><span class="mini-num green">${completed}</span></td>
                    <td>${pending > 0 ? `<span class="mini-num orange">${pending}</span>` : '-'}</td>
                    <td><span class="mini-num blue">${timeStr}</span></td>
                    <td>
                        <div class="rate-bar"><div class="rate-bar-fill ${rateClass}" style="width:${rate}%"></div></div>
                        <span style="font-weight:600;margin-left:3px;">${rate}%</span>
                    </td>
                </tr>`;
            }).join('');
        }

        function renderCheckList() {
            const container = document.getElementById('checkList');
            const filtered = getFilteredWaiting();

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <p>ê²€ì‚¬ ëŒ€ê¸° ì¤‘ì¸ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>`;
                return;
            }

            container.innerHTML = filtered.map((r, idx) => {
                const pageText = r.startPage && r.endPage ? `p.${r.startPage}~${r.endPage}` : '-';
                return `
                <div class="check-item" id="check-${idx}">
                    <div class="info">
                        <div class="name">${r.name} <span style="color:#888;font-size:9px;">${r.floor}</span></div>
                        <div class="detail">${r.subject} Â· ${r.book} Â· ${r.actualTime || 0}ë¶„</div>
                    </div>
                    <div class="page-box">${pageText}</div>
                    <div class="actions">
                        <button class="btn approve" onclick="approveCheck(${r.row}, ${idx})">âœ“</button>
                        <button class="btn reject" onclick="rejectCheck(${r.row}, ${idx})">âœ—</button>
                    </div>
                </div>`;
            }).join('');
        }

        function renderRanking() {
            const container = document.getElementById('rankingList');
            const students = getFilteredStudents();
            
            // í•™ìŠµì‹œê°„ ê¸°ì¤€ ì •ë ¬
            const sorted = [...students]
                .filter(s => (s.totalTime || 0) > 0)
                .sort((a, b) => (b.totalTime || 0) - (a.totalTime || 0))
                .slice(0, 10);

            if (sorted.length === 0) {
                container.innerHTML = '<div style="padding:15px;text-align:center;color:#888;font-size:11px;">í•™ìŠµ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            container.innerHTML = sorted.map((s, i) => {
                const timeStr = (s.totalTime / 60).toFixed(1) + 'h';
                return `
                <div class="ranking-item">
                    <div class="rank-num ${i < 3 ? 'rank-'+(i+1) : 'rank-other'}">${i+1}</div>
                    <div class="rank-info">
                        <span class="rank-name">${s.name}</span>
                        <span class="rank-floor">${s.floor}</span>
                    </div>
                    <div class="rank-value">${timeStr}</div>
                </div>`;
            }).join('');

            // í†µê³„ ì—…ë°ì´íŠ¸
            const activeStudents = students.filter(s => (s.completed || 0) > 0);
            const totalCompleted = students.reduce((s, x) => s + (x.completed || 0), 0);
            const totalTime = students.reduce((s, x) => s + (x.totalTime || 0), 0);
            const avgRate = students.length > 0 ? Math.round(students.reduce((s, x) => s + (x.rate || 0), 0) / students.length) : 0;

            document.getElementById('statCompleted').textContent = totalCompleted;
            document.getElementById('statTime').textContent = (totalTime / 60).toFixed(1) + 'h';
            document.getElementById('statRate').textContent = avgRate + '%';
            document.getElementById('statActive').textContent = activeStudents.length;
        }

        async function approveCheck(row, idx) {
            const item = document.getElementById(`check-${idx}`);
            item.style.opacity = '0.5';
            
            const res = await api({ action: 'approveRecord', row });
            if (res.success) {
                toast('âœ… ìŠ¹ì¸ ì™„ë£Œ', 'success');
                item.remove();
                loadData();
            } else {
                item.style.opacity = '1';
                toast('ì˜¤ë¥˜', 'error');
            }
        }

        async function rejectCheck(row, idx) {
            const item = document.getElementById(`check-${idx}`);
            item.style.opacity = '0.5';
            
            const res = await api({ action: 'rejectRecord', row });
            if (res.success) {
                toast('âŒ ì‹¤íŒ¨ ì²˜ë¦¬', 'success');
                item.remove();
                loadData();
            } else {
                item.style.opacity = '1';
                toast('ì˜¤ë¥˜', 'error');
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            const tabMap = { 'students': 1, 'check': 2, 'stats': 3, 'report': 4 };
            const tabIndex = tabMap[tab] || 1;
            document.querySelector(`.tab:nth-child(${tabIndex})`).classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
            
            // ë³´ê³ ì„œ íƒ­ ì§„ì… ì‹œ í•™ìƒ ëª©ë¡ ë¡œë“œ
            if (tab === 'report') {
                populateReportStudents();
            }
        }

        // ========== í•™ë¶€ëª¨ ë³´ê³ ì„œ ê¸°ëŠ¥ ==========
        
        const subjectColors = {
            'ìˆ˜í•™': '#ef4444', 'ì˜ì–´': '#3b82f6', 'êµ­ì–´': '#10b981',
            'ê³¼í•™': '#f59e0b', 'ì‚¬íšŒ': '#8b5cf6', 'í•œêµ­ì‚¬': '#ec4899',
            'ê¸°íƒ€': '#6b7280'
        };
        
        function populateReportStudents() {
            const select = document.getElementById('reportStudent');
            const currentValue = select.value;
            
            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²«ë²ˆì§¸ ì œì™¸)
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // í•™ìƒ ëª©ë¡ ì¶”ê°€
            const students = [...allStudents].sort((a, b) => {
                if (a.floor !== b.floor) return a.floor.localeCompare(b.floor);
                return a.name.localeCompare(b.name);
            });
            
            students.forEach(s => {
                const opt = document.createElement('option');
                opt.value = `${s.floor}|${s.name}`;
                opt.textContent = `${s.name} (${s.floor})`;
                select.appendChild(opt);
            });
            
            // ê¸°ì¡´ ì„ íƒê°’ ë³µì›
            if (currentValue) select.value = currentValue;
        }
        
        async function loadStudentReport() {
            const studentSelect = document.getElementById('reportStudent');
            const typeSelect = document.getElementById('reportType');
            
            if (!studentSelect.value) {
                document.getElementById('weeklyReportCard').style.display = 'none';
                document.getElementById('monthlyReportCard').style.display = 'none';
                document.getElementById('reportPlaceholder').style.display = 'block';
                return;
            }
            
            const [floor, name] = studentSelect.value.split('|');
            const reportType = typeSelect.value;
            
            document.getElementById('reportPlaceholder').style.display = 'none';
            
            if (reportType === 'week') {
                await loadWeeklyReport(floor, name);
                document.getElementById('weeklyReportCard').style.display = 'block';
                document.getElementById('monthlyReportCard').style.display = 'none';
            } else {
                await loadMonthlyReport(floor, name);
                document.getElementById('weeklyReportCard').style.display = 'none';
                document.getElementById('monthlyReportCard').style.display = 'block';
            }
        }
        
        async function loadWeeklyReport(floor, name) {
            // ì§€ë‚œ ì£¼ ë‚ ì§œ ë²”ìœ„ ê³„ì‚° (ì¼ìš”ì¼ 12ì‹œ ì´í›„ë©´ ì´ë²ˆì£¼, ì•„ë‹ˆë©´ ì§€ë‚œì£¼)
            const now = new Date();
            const day = now.getDay();
            const hour = now.getHours();
            
            let monday, sunday;
            
            // ì¼ìš”ì¼ 12ì‹œ ì´í›„ë©´ ì´ë²ˆì£¼ ë³´ê³ ì„œ
            if (day === 0 && hour >= 12) {
                monday = new Date(now);
                monday.setDate(now.getDate() - 6);
                sunday = new Date(now);
            } else {
                // ì•„ë‹ˆë©´ ì§€ë‚œì£¼ ë³´ê³ ì„œ
                monday = new Date(now);
                monday.setDate(now.getDate() - (day === 0 ? 13 : day + 6));
                sunday = new Date(monday);
                sunday.setDate(monday.getDate() + 6);
            }
            
            const weekStart = formatDate(monday);
            const weekEnd = formatDate(sunday);
            
            // APIì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const res = await api({
                action: 'getStudentWeeklyReport',
                floor: floor,
                name: name,
                weekStart: weekStart,
                weekEnd: weekEnd
            });
            
            // í•™ìƒ ì •ë³´
            document.getElementById('reportStudentName').textContent = name;
            document.getElementById('reportPeriod').textContent = 
                `${monday.getFullYear()}.${monday.getMonth()+1}.${monday.getDate()}(${['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][monday.getDay()]}) ~ ${sunday.getMonth()+1}.${sunday.getDate()}(${['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][sunday.getDay()]})`;
            
            if (res.success && res.report) {
                const r = res.report;
                document.getElementById('rptCompleted').textContent = r.completed || 0;
                document.getElementById('rptPlanned').textContent = r.planned || 0;
                document.getElementById('rptTime').textContent = ((r.totalTime || 0) / 60).toFixed(1) + 'h';
                document.getElementById('rptRate').textContent = r.rate + '%';
                document.getElementById('rptStreak').textContent = r.streak || 0;
                
                // ê³¼ëª©ë³„ í•™ìŠµì‹œê°„ ë°”
                renderSubjectBars('rptSubjectBars', r.subjectTime || {});
            } else {
                // í˜„ì¬ ë°ì´í„°ì—ì„œ ê°€ì ¸ì˜¤ê¸°
                const student = allStudents.find(s => s.floor === floor && s.name === name);
                if (student) {
                    document.getElementById('rptCompleted').textContent = student.completed || 0;
                    document.getElementById('rptPlanned').textContent = student.planned || 0;
                    document.getElementById('rptTime').textContent = ((student.totalTime || 0) / 60).toFixed(1) + 'h';
                    document.getElementById('rptRate').textContent = student.rate + '%';
                    document.getElementById('rptStreak').textContent = '0';
                    document.getElementById('rptSubjectBars').innerHTML = '<div style="color:#888;text-align:center;padding:20px;">ê³¼ëª©ë³„ ë°ì´í„° ì—†ìŒ</div>';
                }
            }
        }
        
        async function loadMonthlyReport(floor, name) {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            
            // ì´ë²ˆë‹¬ 1ì¼ ~ ë§ì¼
            const monthStart = `${year}-${String(month).padStart(2,'0')}-01`;
            const lastDay = new Date(year, month, 0).getDate();
            const monthEnd = `${year}-${String(month).padStart(2,'0')}-${String(lastDay).padStart(2,'0')}`;
            
            // APIì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const res = await api({
                action: 'getStudentMonthlyReport',
                floor: floor,
                name: name,
                monthStart: monthStart,
                monthEnd: monthEnd
            });
            
            // í•™ìƒ ì •ë³´
            document.getElementById('monthStudentName').textContent = name;
            document.getElementById('monthPeriod').textContent = `${year}ë…„ ${month}ì›”`;
            
            if (res.success && res.report) {
                const r = res.report;
                document.getElementById('monthCompleted').textContent = r.completed || 0;
                document.getElementById('monthPlanned').textContent = r.planned || 0;
                document.getElementById('monthTime').textContent = ((r.totalTime || 0) / 60).toFixed(1) + 'h';
                document.getElementById('monthRate').textContent = r.rate + '%';
                
                // ì£¼ì°¨ë³„ ì¶”ì´
                renderWeeklyTrend(r.weeklyRates || []);
                
                // ì„±ê³¼
                renderAchievements(r);
                
                // ê³¼ëª©ë³„ í•™ìŠµì‹œê°„
                renderSubjectBars('monthSubjectBars', r.subjectTime || {});
            } else {
                // ê¸°ë³¸ ë°ì´í„°
                const student = allStudents.find(s => s.floor === floor && s.name === name);
                if (student) {
                    document.getElementById('monthCompleted').textContent = student.completed || 0;
                    document.getElementById('monthPlanned').textContent = student.planned || 0;
                    document.getElementById('monthTime').textContent = ((student.totalTime || 0) / 60).toFixed(1) + 'h';
                    document.getElementById('monthRate').textContent = student.rate + '%';
                }
                document.getElementById('monthWeeklyTrend').innerHTML = '<div style="color:#888;text-align:center;padding:20px;">ì£¼ì°¨ë³„ ë°ì´í„° ì—†ìŒ</div>';
                document.getElementById('monthAchievements').innerHTML = '';
                document.getElementById('monthSubjectBars').innerHTML = '<div style="color:#888;text-align:center;padding:20px;">ê³¼ëª©ë³„ ë°ì´í„° ì—†ìŒ</div>';
            }
        }
        
        function renderSubjectBars(containerId, subjectTime) {
            const container = document.getElementById(containerId);
            const subjects = Object.entries(subjectTime).sort((a, b) => b[1] - a[1]);
            
            if (subjects.length === 0) {
                container.innerHTML = '<div style="color:#888;text-align:center;padding:20px;">ë°ì´í„° ì—†ìŒ</div>';
                return;
            }
            
            const maxTime = Math.max(...subjects.map(s => s[1]));
            
            container.innerHTML = subjects.map(([subj, time]) => {
                const percent = maxTime > 0 ? (time / maxTime * 100) : 0;
                const color = subjectColors[subj] || subjectColors['ê¸°íƒ€'];
                const hours = (time / 60).toFixed(1);
                
                return `
                    <div class="report-subject-bar">
                        <span class="subj-name">${subj}</span>
                        <div class="subj-track">
                            <div class="subj-fill" style="width:${percent}%;background:${color};">${percent > 30 ? hours + 'h' : ''}</div>
                        </div>
                        <span class="subj-time">${hours}h</span>
                    </div>
                `;
            }).join('');
        }
        
        function renderWeeklyTrend(weeklyRates) {
            const container = document.getElementById('monthWeeklyTrend');
            
            if (!weeklyRates || weeklyRates.length === 0) {
                container.innerHTML = '<div style="color:#888;text-align:center;padding:20px;">ì£¼ì°¨ë³„ ë°ì´í„° ì—†ìŒ</div>';
                return;
            }
            
            container.innerHTML = weeklyRates.map((rate, i) => {
                const prevRate = i > 0 ? weeklyRates[i-1] : rate;
                const change = rate - prevRate;
                const changeClass = change > 0 ? 'up' : change < 0 ? 'down' : '';
                const changeText = change > 0 ? `+${change}%` : change < 0 ? `${change}%` : '-';
                const color = rate >= 80 ? '#10b981' : rate >= 60 ? '#f59e0b' : '#ef4444';
                
                return `
                    <div class="trend-week">
                        <span class="week-label">${i+1}ì£¼ì°¨</span>
                        <div class="week-bar">
                            <div class="week-fill" style="width:${rate}%;background:${color};">${rate}%</div>
                        </div>
                        <span class="week-change ${changeClass}">${changeText}</span>
                    </div>
                `;
            }).join('');
        }
        
        function renderAchievements(report) {
            const container = document.getElementById('monthAchievements');
            const achievements = [];
            
            if (report.maxStreak) {
                achievements.push({ icon: 'ğŸ”¥', text: 'ìµœì¥ ì—°ì† í•™ìŠµ', value: report.maxStreak + 'ì¼' });
            }
            if (report.topSubject) {
                achievements.push({ icon: 'ğŸ“š', text: 'ê°€ì¥ ë§ì´ ê³µë¶€í•œ ê³¼ëª©', value: report.topSubject });
            }
            if (report.rank) {
                achievements.push({ icon: 'ğŸ†', text: `${report.floor} ë­í‚¹`, value: report.rank + 'ìœ„' });
            }
            if (report.totalDays) {
                achievements.push({ icon: 'ğŸ“…', text: 'í•™ìŠµí•œ ë‚ ', value: report.totalDays + 'ì¼' });
            }
            
            if (achievements.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = achievements.map(a => `
                <div class="achievement-item">
                    <span class="ach-icon">${a.icon}</span>
                    <span class="ach-text">${a.text}</span>
                    <span class="ach-value">${a.value}</span>
                </div>
            `).join('');
        }
        
        async function copyReportImage(cardId) {
            const card = document.getElementById(cardId);
            const content = card.querySelector('.report-content');
            
            // ë³µì‚¬ ë²„íŠ¼ ì„ì‹œ ìˆ¨ê¹€
            const copyBtn = card.querySelector('.copy-btn');
            const textarea = card.querySelector('textarea');
            const originalBtnDisplay = copyBtn.style.display;
            copyBtn.style.display = 'none';
            
            // textareaë¥¼ divë¡œ ì„ì‹œ ë³€í™˜ (ìº¡ì²˜ìš©)
            let tempDiv = null;
            if (textarea) {
                tempDiv = document.createElement('div');
                tempDiv.style.cssText = textarea.style.cssText;
                tempDiv.style.padding = '12px';
                tempDiv.style.background = '#f8fafc';
                tempDiv.style.borderRadius = '8px';
                tempDiv.style.border = '1px solid #ddd';
                tempDiv.style.minHeight = '60px';
                tempDiv.style.whiteSpace = 'pre-wrap';
                tempDiv.style.fontSize = '0.9rem';
                tempDiv.textContent = textarea.value || 'ì—´ì‹¬íˆ ê³µë¶€í•˜ê³  ìˆìŠµë‹ˆë‹¤! í™”ì´íŒ…! ğŸ’ª';
                textarea.style.display = 'none';
                textarea.parentNode.insertBefore(tempDiv, textarea.nextSibling);
            }
            
            try {
                const canvas = await html2canvas(content, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    useCORS: true
                });
                
                canvas.toBlob(async (blob) => {
                    try {
                        await navigator.clipboard.write([
                            new ClipboardItem({ 'image/png': blob })
                        ]);
                        toast('ğŸ“‹ ì´ë¯¸ì§€ ë³µì‚¬ ì™„ë£Œ! ì¹´í†¡ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”', 'success');
                    } catch (err) {
                        // í´ë¦½ë³´ë“œ ì‹¤íŒ¨ ì‹œ ë‹¤ìš´ë¡œë“œ
                        const url = canvas.toDataURL('image/png');
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `í•™ìŠµë³´ê³ ì„œ_${document.getElementById('reportStudent').selectedOptions[0]?.text || 'í•™ìƒ'}.png`;
                        a.click();
                        toast('ğŸ“¥ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œë¨', 'success');
                    }
                });
            } catch (err) {
                toast('ìº¡ì²˜ ì‹¤íŒ¨: ' + err, 'error');
            } finally {
                // ë³µì›
                copyBtn.style.display = originalBtnDisplay;
                if (textarea) {
                    textarea.style.display = '';
                    if (tempDiv) tempDiv.remove();
                }
            }
        }

        function toast(msg, type = '') {
            const el = document.getElementById('toast');
            el.textContent = msg;
            el.className = 'toast' + (type ? ` ${type}` : '');
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 2000);
        }
    </script>
</body>
</html>
