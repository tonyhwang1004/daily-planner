<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê¹€ì—„ë§ˆë…ì„œì‹¤ | ì„ ìƒë‹˜</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a5f;
            --primary-light: #2d5a8b;
            --accent: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--gray-100);
            min-height: 100vh;
            color: var(--gray-800);
        }

        /* ========== ê³µí†µ í—¤ë” ========== */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .floor-tabs {
            display: flex;
            gap: 0.5rem;
        }
        .floor-tab {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.15);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
        }
        .floor-tab.active {
            background: white;
            color: var(--primary);
        }
        .floor-tab .badge {
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 4px;
        }
        .floor-tab.active .badge {
            background: var(--danger);
        }
        .refresh-btn {
            width: 40px; height: 40px;
            background: rgba(255,255,255,0.15);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
        }
        .refresh-btn.spinning i {
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ========== PC ì „ìš© ìŠ¤íƒ€ì¼ ========== */
        .pc-only { display: block; }
        .mobile-only { display: none; }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* PC íƒ­ */
        .pc-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: white;
            padding: 0.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .pc-tab {
            padding: 0.75rem 1.25rem;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--gray-500);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .pc-tab:hover { background: var(--gray-100); }
        .pc-tab.active { background: var(--primary); color: white; }

        /* ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stat-card {
            background: white;
            border-radius: 14px;
            padding: 1.25rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .stat-icon {
            width: 50px; height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        .stat-icon.blue { background: rgba(59,130,246,0.1); color: var(--accent); }
        .stat-icon.green { background: rgba(16,185,129,0.1); color: var(--success); }
        .stat-icon.orange { background: rgba(245,158,11,0.1); color: var(--warning); }
        .stat-icon.red { background: rgba(239,68,68,0.1); color: var(--danger); }
        .stat-info h3 { font-size: 0.8rem; color: var(--gray-500); }
        .stat-info .value { font-size: 1.75rem; font-weight: 700; color: var(--primary); }

        /* ì¹´ë“œ */
        .card {
            background: white;
            border-radius: 14px;
            padding: 1.25rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--gray-200);
        }
        .card-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .card-title i { color: var(--accent); }

        /* 2ì—´ ê·¸ë¦¬ë“œ */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        /* ê²€ì‚¬ ì•„ì´í…œ */
        .check-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 10px;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--warning);
        }
        .check-item.done {
            border-left-color: var(--success);
            opacity: 0.6;
        }
        .check-info h4 {
            font-size: 0.95rem;
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }
        .check-info p {
            font-size: 0.8rem;
            color: var(--gray-500);
        }
        .check-actions {
            display: flex;
            gap: 0.5rem;
        }
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-secondary { background: var(--gray-200); color: var(--gray-700); }
        .btn-primary { background: var(--accent); color: white; }

        /* í…Œì´ë¸” */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        .data-table th {
            text-align: left;
            padding: 0.75rem;
            background: var(--gray-50);
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray-600);
        }
        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--gray-100);
            font-size: 0.85rem;
        }
        .data-table tr:hover { background: var(--gray-50); }
        .progress-bar {
            width: 80px; height: 6px;
            background: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--success);
        }
        .status-badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .status-badge.good { background: rgba(16,185,129,0.1); color: var(--success); }
        .status-badge.wait { background: rgba(245,158,11,0.1); color: var(--warning); }
        .status-badge.none { background: var(--gray-100); color: var(--gray-500); }

        /* íƒ­ ì½˜í…ì¸  */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray-400);
        }
        .empty-state i { font-size: 3rem; margin-bottom: 1rem; }

        /* í¼ */
        .form-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: end;
        }
        .form-group {
            flex: 1;
            min-width: 150px;
        }
        .form-group label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.4rem;
        }
        .form-group select,
        .form-group input {
            width: 100%;
            padding: 0.6rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 0.9rem;
        }
        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* ========== ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ ========== */
        @media (max-width: 768px) {
            .pc-only { display: none !important; }
            .mobile-only { display: block !important; }

            .header {
                padding: 0.75rem 1rem;
            }
            .logo { font-size: 1rem; }
            .floor-tab {
                padding: 0.4rem 0.75rem;
                font-size: 0.8rem;
            }

            .container { padding: 0; }

            /* ëª¨ë°”ì¼ í†µê³„ ë°” */
            .mobile-stats {
                display: flex;
                background: white;
                padding: 0.75rem;
                justify-content: space-around;
                border-bottom: 1px solid var(--gray-200);
            }
            .mobile-stat {
                text-align: center;
            }
            .mobile-stat .value {
                font-size: 1.5rem;
                font-weight: 700;
            }
            .mobile-stat .value.waiting { color: var(--warning); }
            .mobile-stat .value.done { color: var(--success); }
            .mobile-stat .label {
                font-size: 0.65rem;
                color: var(--gray-500);
            }

            /* ëª¨ë°”ì¼ ë·° í† ê¸€ */
            .mobile-view-toggle {
                display: flex;
                background: var(--gray-100);
                margin: 0.75rem;
                border-radius: 10px;
                padding: 4px;
            }
            .mobile-view-btn {
                flex: 1;
                padding: 0.6rem;
                border: none;
                background: transparent;
                border-radius: 8px;
                font-size: 0.8rem;
                font-weight: 600;
                color: var(--gray-600);
                cursor: pointer;
            }
            .mobile-view-btn.active {
                background: white;
                color: var(--primary);
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            /* ëª¨ë°”ì¼ ê²€ì‚¬ ëª©ë¡ */
            .mobile-list {
                padding: 0 0.75rem 0.75rem;
            }
            .mobile-check-card {
                background: white;
                border-radius: 12px;
                padding: 1rem;
                margin-bottom: 0.75rem;
                border-left: 4px solid var(--warning);
                box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            }
            .mobile-check-card.done {
                border-left-color: var(--success);
                opacity: 0.6;
            }
            .mobile-check-header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 0.5rem;
            }
            .mobile-check-name {
                font-size: 1.1rem;
                font-weight: 700;
                color: var(--primary);
            }
            .mobile-check-time {
                font-size: 0.75rem;
                color: var(--gray-400);
            }
            .mobile-check-detail {
                font-size: 0.85rem;
                color: var(--gray-600);
                margin-bottom: 0.75rem;
            }
            .mobile-check-detail .subject {
                display: inline-block;
                background: var(--gray-100);
                padding: 2px 8px;
                border-radius: 4px;
                font-weight: 600;
                margin-right: 4px;
            }
            .mobile-check-actions {
                display: flex;
                gap: 0.5rem;
            }
            .mobile-btn {
                flex: 1;
                padding: 0.875rem;
                border: none;
                border-radius: 10px;
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }
            .mobile-btn.approve {
                background: var(--success);
                color: white;
            }
            .mobile-btn.reject {
                background: var(--gray-200);
                color: var(--gray-700);
            }

            /* ëª¨ë°”ì¼ í•™ìƒ ê·¸ë¦¬ë“œ */
            .mobile-students-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
                padding: 0 0.75rem 0.75rem;
            }
            .mobile-student-card {
                background: white;
                border-radius: 10px;
                padding: 0.75rem;
                text-align: center;
                box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            }
            .mobile-student-emoji {
                font-size: 1.75rem;
                margin-bottom: 0.25rem;
            }
            .mobile-student-name {
                font-size: 0.8rem;
                font-weight: 600;
                color: var(--gray-800);
            }
            .mobile-student-time {
                font-size: 0.65rem;
                color: var(--gray-500);
            }

            /* ëª¨ë°”ì¼ ë”ë³´ê¸° ë²„íŠ¼ */
            .mobile-more-section {
                padding: 1rem;
                background: white;
                border-top: 1px solid var(--gray-200);
            }
            .mobile-more-btn {
                width: 100%;
                padding: 1rem;
                background: var(--gray-100);
                border: none;
                border-radius: 10px;
                font-size: 0.9rem;
                font-weight: 600;
                color: var(--gray-700);
                margin-bottom: 0.5rem;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            .mobile-more-btn i:last-child {
                color: var(--gray-400);
            }

            /* ëª¨ë°”ì¼ íŒ¨ë„ */
            .mobile-panel {
                display: none;
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background: white;
                z-index: 200;
                overflow-y: auto;
            }
            .mobile-panel.active { display: block; }
            .mobile-panel-header {
                background: var(--primary);
                color: white;
                padding: 1rem;
                display: flex;
                align-items: center;
                gap: 1rem;
                position: sticky;
                top: 0;
            }
            .mobile-panel-back {
                width: 36px; height: 36px;
                background: rgba(255,255,255,0.15);
                border: none;
                border-radius: 8px;
                color: white;
                font-size: 1rem;
            }
            .mobile-panel-title {
                font-size: 1.1rem;
                font-weight: 600;
            }
            .mobile-panel-content {
                padding: 1rem;
            }
        }

        @media (min-width: 769px) {
            .mobile-only { display: none !important; }
            .stats-grid { grid-template-columns: repeat(4, 1fr); }
        }

        @media (max-width: 1024px) and (min-width: 769px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .two-col { grid-template-columns: 1fr; }
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--gray-800);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 500;
            font-weight: 500;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }

        /* ìë™ ìƒˆë¡œê³ ì¹¨ í‘œì‹œ */
        .auto-refresh-text {
            font-size: 0.65rem;
            color: rgba(255,255,255,0.6);
            text-align: center;
            padding-top: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- ========== í—¤ë” ========== -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-chalkboard-teacher"></i>
                <span class="pc-only">ì„ ìƒë‹˜ ëŒ€ì‹œë³´ë“œ</span>
                <span class="mobile-only">ê²€ì‚¬</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <div class="floor-tabs">
                    <button class="floor-tab active" data-floor="7ì¸µ" onclick="selectFloor('7ì¸µ')">
                        7ì¸µ <span class="badge" id="badge7">0</span>
                    </button>
                    <button class="floor-tab" data-floor="8ì¸µ" onclick="selectFloor('8ì¸µ')">
                        8ì¸µ <span class="badge" id="badge8">0</span>
                    </button>
                </div>
                <button class="refresh-btn" id="refreshBtn" onclick="refresh()">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="auto-refresh-text mobile-only">30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨</div>
    </header>

    <!-- ========== PC ë²„ì „ ========== -->
    <div class="pc-only">
        <div class="container">
            <div class="pc-tabs">
                <button class="pc-tab active" onclick="showPcTab('dashboard')"><i class="fas fa-chart-pie"></i> ëŒ€ì‹œë³´ë“œ</button>
                <button class="pc-tab" onclick="showPcTab('approval')"><i class="fas fa-clipboard-check"></i> ê²€ì‚¬ ìŠ¹ì¸</button>
                <button class="pc-tab" onclick="showPcTab('students')"><i class="fas fa-users"></i> í•™ìƒ í˜„í™©</button>
                <button class="pc-tab" onclick="showPcTab('points')"><i class="fas fa-star"></i> ìƒë²Œì </button>
                <button class="pc-tab" onclick="showPcTab('reports')"><i class="fas fa-file-alt"></i> ë¦¬í¬íŠ¸</button>
            </div>

            <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
            <div class="tab-content active" id="pc-dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3>ì´ í•™ìƒ</h3>
                            <div class="value" id="pc-totalStudents">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green"><i class="fas fa-calendar-check"></i></div>
                        <div class="stat-info">
                            <h3>ì˜¤ëŠ˜ ê³„íš</h3>
                            <div class="value" id="pc-todayPlans">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange"><i class="fas fa-check-circle"></i></div>
                        <div class="stat-info">
                            <h3>ì™„ë£Œ</h3>
                            <div class="value" id="pc-completed">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon red"><i class="fas fa-clock"></i></div>
                        <div class="stat-info">
                            <h3>ê²€ì‚¬ ëŒ€ê¸°</h3>
                            <div class="value" id="pc-pending">0</div>
                        </div>
                    </div>
                </div>

                <div class="two-col">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-clock"></i> ê²€ì‚¬ ëŒ€ê¸°</div>
                            <button class="btn btn-secondary" onclick="showPcTab('approval')">ì „ì²´ ë³´ê¸°</button>
                        </div>
                        <div id="pc-pendingPreview"></div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-trophy"></i> ì˜¤ëŠ˜ ì‹¤ì²œìœ¨ TOP 5</div>
                        </div>
                        <div id="pc-topStudents"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-users"></i> í•™ìƒë³„ ì˜¤ëŠ˜ í˜„í™©</div>
                        <span id="pc-currentDate" style="color: var(--gray-500); font-size: 0.85rem;"></span>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ì´ë¦„</th>
                                    <th>ê³„íš</th>
                                    <th>ì™„ë£Œ</th>
                                    <th>ëŒ€ê¸°</th>
                                    <th>ì‹¤ì²œìœ¨</th>
                                    <th>ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody id="pc-studentTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ê²€ì‚¬ ìŠ¹ì¸ íƒ­ -->
            <div class="tab-content" id="pc-approval">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-clipboard-check"></i> ê²€ì‚¬ ìš”ì²­ ëª©ë¡</div>
                        <button class="btn btn-secondary" onclick="refresh()"><i class="fas fa-sync"></i> ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                    <div id="pc-pendingList"></div>
                </div>
            </div>

            <!-- í•™ìƒ í˜„í™© íƒ­ -->
            <div class="tab-content" id="pc-students">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-users"></i> ì „ì²´ í•™ìƒ í˜„í™©</div>
                        <input type="date" id="pc-statusDate" onchange="loadStudentsTab()" style="padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: 6px;">
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ì´ë¦„</th>
                                    <th>ê³„íš</th>
                                    <th>ì™„ë£Œ</th>
                                    <th>ì‹¤ì²œìœ¨</th>
                                    <th>ê³µë¶€ì‹œê°„</th>
                                </tr>
                            </thead>
                            <tbody id="pc-allStudents"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ìƒë²Œì  íƒ­ -->
            <div class="tab-content" id="pc-points">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-star"></i> ìƒë²Œì  ë¶€ì—¬</div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>í•™ìƒ</label>
                            <select id="pc-pointStudent"></select>
                        </div>
                        <div class="form-group">
                            <label>ì ìˆ˜</label>
                            <select id="pc-pointScore">
                                <option value="1">+1 (ìƒì )</option>
                                <option value="2">+2 (ìƒì )</option>
                                <option value="3">+3 (ìƒì )</option>
                                <option value="-1">-1 (ë²Œì )</option>
                                <option value="-2">-2 (ë²Œì )</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 2;">
                            <label>ì‚¬ìœ </label>
                            <input type="text" id="pc-pointReason" placeholder="ì˜ˆ: ì£¼ê°„ ë­í‚¹ 1ìœ„">
                        </div>
                        <button class="btn btn-primary" onclick="addPoint()" style="height: 38px;">ë¶€ì—¬</button>
                    </div>
                </div>
            </div>

            <!-- ë¦¬í¬íŠ¸ íƒ­ -->
            <div class="tab-content" id="pc-reports">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-file-alt"></i> ì›”ê°„ ë¦¬í¬íŠ¸</div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>í•™ìƒ</label>
                            <select id="pc-reportStudent"></select>
                        </div>
                        <div class="form-group">
                            <label>ë…„ì›”</label>
                            <input type="month" id="pc-reportMonth">
                        </div>
                        <button class="btn btn-primary" onclick="generateReport()" style="height: 38px;">ìƒì„±</button>
                    </div>
                </div>
                <div class="card" id="pc-reportResult" style="display: none;">
                    <div class="card-header">
                        <div class="card-title" id="pc-reportTitle">ë¦¬í¬íŠ¸</div>
                        <button class="btn btn-secondary" onclick="copyReport()"><i class="fas fa-copy"></i> ë³µì‚¬</button>
                    </div>
                    <div id="pc-reportContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== ëª¨ë°”ì¼ ë²„ì „ ========== -->
    <div class="mobile-only">
        <!-- í†µê³„ ë°” -->
        <div class="mobile-stats">
            <div class="mobile-stat">
                <div class="value waiting" id="m-pending">0</div>
                <div class="label">ëŒ€ê¸°</div>
            </div>
            <div class="mobile-stat">
                <div class="value done" id="m-approved">0</div>
                <div class="label">ìŠ¹ì¸</div>
            </div>
            <div class="mobile-stat">
                <div class="value" id="m-rejected" style="color: var(--danger);">0</div>
                <div class="label">ë¯¸ì™„ë£Œ</div>
            </div>
            <div class="mobile-stat">
                <div class="value" id="m-total">0</div>
                <div class="label">ì´</div>
            </div>
        </div>

        <!-- ë·° í† ê¸€ -->
        <div class="mobile-view-toggle">
            <button class="mobile-view-btn active" onclick="switchMobileView('check')">ğŸ“‹ ê²€ì‚¬ ëŒ€ê¸°</button>
            <button class="mobile-view-btn" onclick="switchMobileView('students')">ğŸ‘¥ í•™ìƒ í˜„í™©</button>
        </div>

        <!-- ê²€ì‚¬ ëª©ë¡ -->
        <div id="m-checkView" class="mobile-list"></div>

        <!-- í•™ìƒ í˜„í™© -->
        <div id="m-studentsView" class="mobile-students-grid" style="display: none;"></div>

        <!-- ë”ë³´ê¸° -->
        <div class="mobile-more-section">
            <button class="mobile-more-btn" onclick="openMobilePanel('points')">
                <span><i class="fas fa-star" style="color: var(--warning);"></i> ìƒë²Œì  ë¶€ì—¬</span>
                <i class="fas fa-chevron-right"></i>
            </button>
            <button class="mobile-more-btn" onclick="openMobilePanel('report')">
                <span><i class="fas fa-file-alt" style="color: var(--accent);"></i> ë¦¬í¬íŠ¸ ìƒì„±</span>
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- ëª¨ë°”ì¼ íŒ¨ë„: ìƒë²Œì  -->
    <div class="mobile-panel" id="m-pointsPanel">
        <div class="mobile-panel-header">
            <button class="mobile-panel-back" onclick="closeMobilePanel('points')"><i class="fas fa-arrow-left"></i></button>
            <div class="mobile-panel-title">ìƒë²Œì  ë¶€ì—¬</div>
        </div>
        <div class="mobile-panel-content">
            <div class="form-group" style="margin-bottom: 1rem;">
                <label>í•™ìƒ</label>
                <select id="m-pointStudent" style="width: 100%; padding: 0.75rem;"></select>
            </div>
            <div class="form-group" style="margin-bottom: 1rem;">
                <label>ì ìˆ˜</label>
                <select id="m-pointScore" style="width: 100%; padding: 0.75rem;">
                    <option value="1">+1 (ìƒì )</option>
                    <option value="2">+2 (ìƒì )</option>
                    <option value="3">+3 (ìƒì )</option>
                    <option value="-1">-1 (ë²Œì )</option>
                    <option value="-2">-2 (ë²Œì )</option>
                </select>
            </div>
            <div class="form-group" style="margin-bottom: 1rem;">
                <label>ì‚¬ìœ </label>
                <input type="text" id="m-pointReason" placeholder="ì˜ˆ: ì£¼ê°„ ë­í‚¹ 1ìœ„" style="width: 100%; padding: 0.75rem;">
            </div>
            <button class="btn btn-primary" onclick="addPointMobile()" style="width: 100%; padding: 1rem;">ë¶€ì—¬í•˜ê¸°</button>
        </div>
    </div>

    <!-- ëª¨ë°”ì¼ íŒ¨ë„: ë¦¬í¬íŠ¸ -->
    <div class="mobile-panel" id="m-reportPanel">
        <div class="mobile-panel-header">
            <button class="mobile-panel-back" onclick="closeMobilePanel('report')"><i class="fas fa-arrow-left"></i></button>
            <div class="mobile-panel-title">ì›”ê°„ ë¦¬í¬íŠ¸</div>
        </div>
        <div class="mobile-panel-content">
            <div class="form-group" style="margin-bottom: 1rem;">
                <label>í•™ìƒ</label>
                <select id="m-reportStudent" style="width: 100%; padding: 0.75rem;"></select>
            </div>
            <div class="form-group" style="margin-bottom: 1rem;">
                <label>ë…„ì›”</label>
                <input type="month" id="m-reportMonth" style="width: 100%; padding: 0.75rem;">
            </div>
            <button class="btn btn-primary" onclick="generateReportMobile()" style="width: 100%; padding: 1rem;">ë¦¬í¬íŠ¸ ìƒì„±</button>
            <div id="m-reportResult" style="margin-top: 1rem;"></div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ -->
    <div class="toast" id="toast"></div>

    <script>
        const API = 'https://script.google.com/macros/s/AKfycbwGFbsj8FgFIuF-iFkJ4ekyS76MWQf9UrUysJ-Fs12vuVByJwenoYRgOJeOZiPOa6gzkg/exec';
        
        let currentFloor = '7ì¸µ';
        let pendingRequests = [];
        let todayRecords = [];
        let allStudents = [];
        let autoRefreshInterval = null;

        function fmt(d) { return d.toISOString().split('T')[0]; }

        async function api(data) {
            try {
                const res = await fetch(API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(data)
                });
                return await res.json();
            } catch { return { success: false }; }
        }

        // ì´ˆê¸°í™”
        async function init() {
            document.getElementById('pc-statusDate').value = fmt(new Date());
            document.getElementById('pc-reportMonth').value = fmt(new Date()).slice(0, 7);
            document.getElementById('m-reportMonth').value = fmt(new Date()).slice(0, 7);
            document.getElementById('pc-currentDate').textContent = new Date().toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'short' });
            
            await loadAllStudents();
            await refresh();
            
            // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
            autoRefreshInterval = setInterval(refresh, 30000);
        }

        async function loadAllStudents() {
            const [res7, res8] = await Promise.all([
                api({ action: 'getStudents', floor: '7ì¸µ' }),
                api({ action: 'getStudents', floor: '8ì¸µ' })
            ]);
            
            allStudents = [
                ...(res7.success ? res7.students.map(s => ({...s, floor: '7ì¸µ'})) : []),
                ...(res8.success ? res8.students.map(s => ({...s, floor: '8ì¸µ'})) : [])
            ];
            
            // í•™ìƒ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
            const options = '<option value="">ì„ íƒ</option>' + 
                allStudents.map(s => `<option value="${s.floor}|${s.name}">[${s.floor}] ${s.name}</option>`).join('');
            
            ['pc-pointStudent', 'pc-reportStudent', 'm-pointStudent', 'm-reportStudent'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = options;
            });
        }

        async function refresh() {
            const btn = document.getElementById('refreshBtn');
            btn.classList.add('spinning');
            
            await loadPendingRequests();
            await loadTodayRecords();
            updateUI();
            
            btn.classList.remove('spinning');
        }

        async function loadPendingRequests() {
            const today = fmt(new Date());
            const [res7, res8] = await Promise.all([
                api({ action: 'getPendingChecks', floor: '7ì¸µ', date: today }),
                api({ action: 'getPendingChecks', floor: '8ì¸µ', date: today })
            ]);
            
            pendingRequests = [
                ...(res7.success ? res7.records.map(r => ({...r, floor: '7ì¸µ'})) : []),
                ...(res8.success ? res8.records.map(r => ({...r, floor: '8ì¸µ'})) : [])
            ];
        }

        async function loadTodayRecords() {
            const today = fmt(new Date());
            const [res7, res8] = await Promise.all([
                api({ action: 'getTodayRecords', floor: '7ì¸µ', date: today }),
                api({ action: 'getTodayRecords', floor: '8ì¸µ', date: today })
            ]);
            
            todayRecords = [
                ...(res7.success ? res7.records.map(r => ({...r, floor: '7ì¸µ'})) : []),
                ...(res8.success ? res8.records.map(r => ({...r, floor: '8ì¸µ'})) : [])
            ];
        }

        function updateUI() {
            // ë°°ì§€ ì—…ë°ì´íŠ¸
            const pending7 = pendingRequests.filter(r => r.floor === '7ì¸µ').length;
            const pending8 = pendingRequests.filter(r => r.floor === '8ì¸µ').length;
            document.getElementById('badge7').textContent = pending7;
            document.getElementById('badge8').textContent = pending8;

            // í˜„ì¬ ì¸µ ë°ì´í„°
            const floorPending = pendingRequests.filter(r => r.floor === currentFloor);
            const floorRecords = todayRecords.filter(r => r.floor === currentFloor);
            const approved = floorRecords.filter(r => r.status === 'approved' || r.status === 'O').length;
            const rejected = floorRecords.filter(r => r.status === 'failed' || r.status === 'X').length;

            // PC ëŒ€ì‹œë³´ë“œ
            const floorStudents = allStudents.filter(s => s.floor === currentFloor);
            document.getElementById('pc-totalStudents').textContent = floorStudents.length;
            document.getElementById('pc-todayPlans').textContent = floorRecords.length;
            document.getElementById('pc-completed').textContent = approved;
            document.getElementById('pc-pending').textContent = floorPending.length;

            // ëª¨ë°”ì¼ í†µê³„
            document.getElementById('m-pending').textContent = floorPending.length;
            document.getElementById('m-approved').textContent = approved;
            document.getElementById('m-rejected').textContent = rejected;
            document.getElementById('m-total').textContent = floorRecords.length;

            renderPendingLists();
            renderStudentStatus();
            renderMobileViews();
        }

        function renderPendingLists() {
            const floorPending = pendingRequests.filter(r => r.floor === currentFloor);
            
            // PC ë¯¸ë¦¬ë³´ê¸° (3ê°œ)
            const preview = document.getElementById('pc-pendingPreview');
            if (floorPending.length > 0) {
                preview.innerHTML = floorPending.slice(0, 3).map(r => `
                    <div class="check-item">
                        <div class="check-info">
                            <h4>${r.name} - ${r.book || r.bookName}</h4>
                            <p>${r.subject} Â· ${r.actualTime || r.time}ë¶„</p>
                        </div>
                        <div class="check-actions">
                            <button class="btn btn-success" onclick="approve('${r.name}','${r.date}','${r.subject}','${r.book || r.bookName}')">ìŠ¹ì¸</button>
                        </div>
                    </div>
                `).join('');
            } else {
                preview.innerHTML = '<div class="empty-state"><i class="fas fa-check-circle"></i><p>ëŒ€ê¸° ì—†ìŒ</p></div>';
            }

            // PC ì „ì²´ ëª©ë¡
            const fullList = document.getElementById('pc-pendingList');
            if (floorPending.length > 0) {
                fullList.innerHTML = floorPending.map(r => `
                    <div class="check-item">
                        <div class="check-info">
                            <h4>${r.name} - [${r.subject}] ${r.book || r.bookName}</h4>
                            <p>â±ï¸ ${r.actualTime || r.time}ë¶„ ${r.startPage ? `Â· ğŸ“– p.${r.startPage}~${r.endPage}` : ''}</p>
                        </div>
                        <div class="check-actions">
                            <button class="btn btn-success" onclick="approve('${r.name}','${r.date}','${r.subject}','${r.book || r.bookName}')"><i class="fas fa-check"></i> ìŠ¹ì¸</button>
                            <button class="btn btn-danger" onclick="reject('${r.name}','${r.date}','${r.subject}','${r.book || r.bookName}')"><i class="fas fa-times"></i> ë°˜ë ¤</button>
                        </div>
                    </div>
                `).join('');
            } else {
                fullList.innerHTML = '<div class="empty-state"><i class="fas fa-check-circle"></i><p>ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ‰</p></div>';
            }
        }

        function renderStudentStatus() {
            // í•™ìƒë³„ ì˜¤ëŠ˜ í˜„í™© ì§‘ê³„
            const floorStudents = allStudents.filter(s => s.floor === currentFloor);
            const statusData = floorStudents.map(student => {
                const records = todayRecords.filter(r => r.floor === currentFloor && r.name === student.name);
                const pending = pendingRequests.filter(r => r.floor === currentFloor && r.name === student.name).length;
                const completed = records.filter(r => r.status === 'approved' || r.status === 'O').length;
                const total = records.length + pending;
                const rate = total > 0 ? Math.round(completed / total * 100) : 0;
                return { name: student.name, total, completed, pending, rate };
            });

            // PC í…Œì´ë¸”
            const tbody = document.getElementById('pc-studentTable');
            tbody.innerHTML = statusData.map(s => {
                let statusClass = 'none', statusText = 'ë¯¸ë“±ë¡';
                if (s.total > 0) {
                    if (s.rate >= 80) { statusClass = 'good'; statusText = 'ìš°ìˆ˜'; }
                    else if (s.pending > 0) { statusClass = 'wait'; statusText = 'ê²€ì‚¬ëŒ€ê¸°'; }
                    else { statusClass = 'none'; statusText = 'ì§„í–‰ì¤‘'; }
                }
                return `<tr>
                    <td style="font-weight: 600;">${s.name}</td>
                    <td>${s.total}</td>
                    <td>${s.completed}</td>
                    <td>${s.pending}</td>
                    <td><div style="display:flex;align-items:center;gap:0.5rem;">
                        <div class="progress-bar"><div class="progress-fill" style="width:${s.rate}%"></div></div>
                        ${s.rate}%
                    </div></td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                </tr>`;
            }).join('');

            // PC TOP 5
            const top5 = statusData.filter(s => s.total > 0).sort((a, b) => b.rate - a.rate).slice(0, 5);
            const topContainer = document.getElementById('pc-topStudents');
            if (top5.length > 0) {
                topContainer.innerHTML = top5.map((s, i) => `
                    <div style="display:flex;justify-content:space-between;padding:0.6rem 0;${i < top5.length - 1 ? 'border-bottom:1px solid var(--gray-100);' : ''}">
                        <div style="display:flex;align-items:center;gap:0.75rem;">
                            <span style="width:24px;height:24px;background:${['#fbbf24','#9ca3af','#f97316'][i] || 'var(--gray-200)'};border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.7rem;font-weight:700;color:${i < 3 ? 'white' : 'var(--gray-600)'};">${i + 1}</span>
                            <span style="font-weight:600;">${s.name}</span>
                        </div>
                        <span style="font-weight:600;color:var(--success);">${s.rate}%</span>
                    </div>
                `).join('');
            } else {
                topContainer.innerHTML = '<div class="empty-state"><p>ë°ì´í„° ì—†ìŒ</p></div>';
            }
        }

        function renderMobileViews() {
            const floorPending = pendingRequests.filter(r => r.floor === currentFloor);
            const floorRecords = todayRecords.filter(r => r.floor === currentFloor);

            // ëª¨ë°”ì¼ ê²€ì‚¬ ëª©ë¡
            const checkView = document.getElementById('m-checkView');
            if (floorPending.length > 0) {
                checkView.innerHTML = floorPending.map(r => `
                    <div class="mobile-check-card">
                        <div class="mobile-check-header">
                            <div class="mobile-check-name">${r.name}</div>
                            <div class="mobile-check-time">${r.requestTime ? new Date(r.requestTime).toLocaleTimeString('ko-KR', {hour:'2-digit',minute:'2-digit'}) : ''}</div>
                        </div>
                        <div class="mobile-check-detail">
                            <span class="subject">${r.subject}</span> ${r.book || r.bookName}
                            <br>â±ï¸ ${r.actualTime || r.time}ë¶„ ${r.startPage ? `Â· ğŸ“– p.${r.startPage}~${r.endPage}` : ''}
                        </div>
                        <div class="mobile-check-actions">
                            <button class="mobile-btn reject" onclick="reject('${r.name}','${r.date}','${r.subject}','${r.book || r.bookName}')">
                                <i class="fas fa-times"></i> ë‹¤ì‹œí•´
                            </button>
                            <button class="mobile-btn approve" onclick="approve('${r.name}','${r.date}','${r.subject}','${r.book || r.bookName}')">
                                <i class="fas fa-check"></i> ìŠ¹ì¸
                            </button>
                        </div>
                    </div>
                `).join('');
            } else {
                checkView.innerHTML = '<div class="empty-state" style="padding:2rem;"><i class="fas fa-check-circle"></i><p>ê²€ì‚¬ ëŒ€ê¸° ì—†ìŒ ğŸ‰</p></div>';
            }

            // ëª¨ë°”ì¼ í•™ìƒ í˜„í™©
            const studentsView = document.getElementById('m-studentsView');
            const floorStudents = allStudents.filter(s => s.floor === currentFloor);
            const studentTimes = {};
            floorRecords.forEach(r => {
                if (!studentTimes[r.name]) studentTimes[r.name] = 0;
                if (r.status === 'approved' || r.status === 'O') {
                    studentTimes[r.name] += (r.actualTime || r.time || 0);
                }
            });

            const sortedStudents = floorStudents.map(s => ({
                name: s.name,
                time: studentTimes[s.name] || 0
            })).sort((a, b) => b.time - a.time);

            studentsView.innerHTML = sortedStudents.map(s => {
                let emoji = 'ğŸ˜´';
                if (s.time >= 480) emoji = 'ğŸ˜Š';
                else if (s.time >= 240) emoji = 'ğŸ™‚';
                else if (s.time > 0) emoji = 'ğŸ˜¢';
                
                const h = Math.floor(s.time / 60);
                const m = s.time % 60;
                const timeStr = h > 0 ? `${h}ì‹œê°„ ${m}ë¶„` : `${m}ë¶„`;

                return `<div class="mobile-student-card">
                    <div class="mobile-student-emoji">${emoji}</div>
                    <div class="mobile-student-name">${s.name}</div>
                    <div class="mobile-student-time">${timeStr}</div>
                </div>`;
            }).join('');
        }

        // ì¸µ ì„ íƒ
        function selectFloor(floor) {
            currentFloor = floor;
            document.querySelectorAll('.floor-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.floor === floor);
            });
            updateUI();
        }

        // PC íƒ­ ì „í™˜
        function showPcTab(tabId) {
            document.querySelectorAll('.pc-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.closest('.pc-tab').classList.add('active');
            document.getElementById('pc-' + tabId).classList.add('active');

            if (tabId === 'students') loadStudentsTab();
        }

        async function loadStudentsTab() {
            const date = document.getElementById('pc-statusDate').value;
            const res = await api({ action: 'getTodayRecords', floor: currentFloor, date });
            
            const tbody = document.getElementById('pc-allStudents');
            if (res.success) {
                const records = res.records || [];
                const studentData = {};
                
                records.forEach(r => {
                    if (!studentData[r.name]) {
                        studentData[r.name] = { total: 0, completed: 0, time: 0 };
                    }
                    studentData[r.name].total++;
                    if (r.status === 'approved' || r.status === 'O') {
                        studentData[r.name].completed++;
                        studentData[r.name].time += (r.actualTime || r.time || 0);
                    }
                });

                const rows = Object.entries(studentData).map(([name, d]) => {
                    const rate = d.total > 0 ? Math.round(d.completed / d.total * 100) : 0;
                    const hours = Math.floor(d.time / 60);
                    const mins = d.time % 60;
                    return `<tr>
                        <td style="font-weight:600;">${name}</td>
                        <td>${d.total}</td>
                        <td>${d.completed}</td>
                        <td>${rate}%</td>
                        <td>${hours}h ${mins}m</td>
                    </tr>`;
                });

                tbody.innerHTML = rows.length > 0 ? rows.join('') : '<tr><td colspan="5" class="empty-state">ë°ì´í„° ì—†ìŒ</td></tr>';
            }
        }

        // ëª¨ë°”ì¼ ë·° ì „í™˜
        function switchMobileView(view) {
            document.querySelectorAll('.mobile-view-btn').forEach((b, i) => {
                b.classList.toggle('active', (view === 'check' && i === 0) || (view === 'students' && i === 1));
            });
            document.getElementById('m-checkView').style.display = view === 'check' ? 'block' : 'none';
            document.getElementById('m-studentsView').style.display = view === 'students' ? 'grid' : 'none';
        }

        // ëª¨ë°”ì¼ íŒ¨ë„
        function openMobilePanel(type) {
            document.getElementById('m-' + type + 'Panel').classList.add('active');
        }
        function closeMobilePanel(type) {
            document.getElementById('m-' + type + 'Panel').classList.remove('active');
        }

        // ìŠ¹ì¸
        async function approve(name, date, subject, book) {
            const res = await api({
                action: 'approveCheck',
                floor: currentFloor,
                name, date, subject, bookName: book
            });
            
            if (res.success) {
                toast('âœ… ìŠ¹ì¸ ì™„ë£Œ!', 'success');
                const idx = pendingRequests.findIndex(r => r.name === name && r.date === date && r.subject === subject);
                if (idx > -1) {
                    const record = pendingRequests.splice(idx, 1)[0];
                    record.status = 'approved';
                    todayRecords.push(record);
                }
                updateUI();
            } else {
                toast('ìŠ¹ì¸ ì‹¤íŒ¨', 'error');
            }
        }

        // ë°˜ë ¤
        async function reject(name, date, subject, book) {
            const res = await api({
                action: 'rejectCheck',
                floor: currentFloor,
                name, date, subject, bookName: book
            });
            
            if (res.success) {
                toast('âŒ ë¯¸ì™„ë£Œ ì²˜ë¦¬ë¨', 'error');
                const idx = pendingRequests.findIndex(r => r.name === name && r.date === date && r.subject === subject);
                if (idx > -1) {
                    const record = pendingRequests.splice(idx, 1)[0];
                    record.status = 'failed';
                    todayRecords.push(record);
                }
                updateUI();
            }
        }

        // ìƒë²Œì 
        async function addPoint() {
            const val = document.getElementById('pc-pointStudent').value;
            if (!val) return toast('í•™ìƒ ì„ íƒ');
            const [floor, name] = val.split('|');
            const score = document.getElementById('pc-pointScore').value;
            const reason = document.getElementById('pc-pointReason').value;
            if (!reason) return toast('ì‚¬ìœ  ì…ë ¥');

            const res = await api({ action: 'addPoint', floor, name, score: parseInt(score), reason });
            if (res.success) {
                toast('âœ… ìƒë²Œì  ë¶€ì—¬ë¨', 'success');
                document.getElementById('pc-pointReason').value = '';
            }
        }

        async function addPointMobile() {
            const val = document.getElementById('m-pointStudent').value;
            if (!val) return toast('í•™ìƒ ì„ íƒ');
            const [floor, name] = val.split('|');
            const score = document.getElementById('m-pointScore').value;
            const reason = document.getElementById('m-pointReason').value;
            if (!reason) return toast('ì‚¬ìœ  ì…ë ¥');

            const res = await api({ action: 'addPoint', floor, name, score: parseInt(score), reason });
            if (res.success) {
                toast('âœ… ìƒë²Œì  ë¶€ì—¬ë¨', 'success');
                document.getElementById('m-pointReason').value = '';
                closeMobilePanel('points');
            }
        }

        // ë¦¬í¬íŠ¸
        async function generateReport() {
            const val = document.getElementById('pc-reportStudent').value;
            if (!val) return toast('í•™ìƒ ì„ íƒ');
            const [floor, name] = val.split('|');
            const ym = document.getElementById('pc-reportMonth').value.split('-');

            const res = await api({
                action: 'getMonthlyReport',
                floor, name,
                year: parseInt(ym[0]),
                month: parseInt(ym[1])
            });

            if (res.success) {
                const r = res.report;
                document.getElementById('pc-reportResult').style.display = 'block';
                document.getElementById('pc-reportTitle').textContent = `${name} - ${ym[0]}ë…„ ${ym[1]}ì›” ë¦¬í¬íŠ¸`;
                document.getElementById('pc-reportContent').innerHTML = `
                    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1rem;">
                        <div style="background:var(--gray-50);padding:1rem;border-radius:10px;text-align:center;">
                            <div style="font-size:0.8rem;color:var(--gray-500);">ì´ ê³„íš</div>
                            <div style="font-size:1.5rem;font-weight:700;color:var(--primary);">${r.stats.totalPlans}</div>
                        </div>
                        <div style="background:var(--gray-50);padding:1rem;border-radius:10px;text-align:center;">
                            <div style="font-size:0.8rem;color:var(--gray-500);">ì™„ë£Œ</div>
                            <div style="font-size:1.5rem;font-weight:700;color:var(--success);">${r.stats.completed}</div>
                        </div>
                        <div style="background:var(--gray-50);padding:1rem;border-radius:10px;text-align:center;">
                            <div style="font-size:0.8rem;color:var(--gray-500);">ì‹¤ì²œìœ¨</div>
                            <div style="font-size:1.5rem;font-weight:700;color:var(--warning);">${r.stats.rate}%</div>
                        </div>
                        <div style="background:var(--gray-50);padding:1rem;border-radius:10px;text-align:center;">
                            <div style="font-size:0.8rem;color:var(--gray-500);">ê³µë¶€ì‹œê°„</div>
                            <div style="font-size:1.5rem;font-weight:700;color:var(--accent);">${r.stats.totalTimeHours}h</div>
                        </div>
                    </div>
                `;
            }
        }

        async function generateReportMobile() {
            const val = document.getElementById('m-reportStudent').value;
            if (!val) return toast('í•™ìƒ ì„ íƒ');
            const [floor, name] = val.split('|');
            const ym = document.getElementById('m-reportMonth').value.split('-');

            const res = await api({
                action: 'getMonthlyReport',
                floor, name,
                year: parseInt(ym[0]),
                month: parseInt(ym[1])
            });

            if (res.success) {
                const r = res.report;
                document.getElementById('m-reportResult').innerHTML = `
                    <div style="background:var(--gray-50);padding:1rem;border-radius:10px;">
                        <h4 style="margin-bottom:0.75rem;">${name} - ${ym[0]}ë…„ ${ym[1]}ì›”</h4>
                        <p>ğŸ“Š ì´ ê³„íš: ${r.stats.totalPlans}ê°œ</p>
                        <p>âœ… ì™„ë£Œ: ${r.stats.completed}ê°œ</p>
                        <p>ğŸ“ˆ ì‹¤ì²œìœ¨: ${r.stats.rate}%</p>
                        <p>â±ï¸ ê³µë¶€ì‹œê°„: ${r.stats.totalTimeHours}ì‹œê°„</p>
                    </div>
                `;
            }
        }

        function copyReport() {
            const title = document.getElementById('pc-reportTitle').textContent;
            const content = document.getElementById('pc-reportContent').innerText;
            navigator.clipboard.writeText(title + '\n' + content);
            toast('ğŸ“‹ ë³µì‚¬ë¨', 'success');
        }

        function toast(msg, type = '') {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.className = 'toast ' + type;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        // ì‹œì‘
        init();
    </script>
</body>
</html>
